<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مونوگراف سیترات کلسیم (USP)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
<script type="text/javascript" id="MathJax-script" async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script>
MathJax = {
tex: {
inlineMath: [['$', '$'], ['\\(', '\\)']],
displayMath: [['$$', '$$'], ['\\[', '\\]']]
},
svg: {
fontCache: 'global'
}
};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- Include jsPDF library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    font-family: 'Vazirmatn', sans-serif;
    background-color: #f8f9fa;
    line-height: 1.6;
    word-spacing: normal;
    letter-spacing: normal;
}
.tab-active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
.tab-inactive { border-color: transparent; color: #6b7280; }
.chart-container { position: relative; width: 100%; max-width: 800px; margin-right: auto; margin-left: auto; height: 350px; max-height: 40vh; }
/* Ensure all tables are RTL by default, with specific LTR for numbers/formulas */
table {
    direction: rtl;
    text-align: right;
}
th {
    text-align: right;
    vertical-align: top;
}
td {
    text-align: right;
    vertical-align: middle;
}

/* Specific override for the results column in COA */
#coa-results-table-body td:last-child {
    text-align: left !important; /* Align results content to the left, important for override */
    direction: ltr; /* Ensure LTR for numbers/results */
}

/* Specific override for the 'نتایج' header in COA */
#coa-content-to-pdf table thead th:last-child {
    text-align: left !important;
}

/* Ensure vertical alignment for all headers in COA table */
#coa-content-to-pdf table thead th {
    vertical-align: top !important;
}

.card {
    background-color: white;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    padding: 1.5rem;
    line-height: inherit;
    word-spacing: inherit;
    letter-spacing: inherit;
    white-space: normal;
}
/* Ensure LTR for specific numerical/unit strings within RTL context */
.ltr-text {
    direction: ltr;
    display: inline-block;
    unicode-bidi: isolate;
}
/* Style for the math input fields to be text boxes */
.math-input {
    appearance: none;
    -moz-appearance: textfield;
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    width: 100px;
    text-align: left;
    direction: ltr;
}
.math-input-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

/* Specific styles for the COA section to help with rendering */
#coa-content-to-pdf {
    direction: ltr; /* COA is LTR */
    text-align: left; /* Default text alignment for LTR */
    padding: 1.5rem;
}

/* Ensure all relevant text within COA inherits proper text settings */
#coa-content-to-pdf p,
#coa-content-to-pdf h1,
#coa-content-to-pdf h2,
#coa-content-to-pdf h3,
#coa-content-to-pdf th,
#coa-content-to-pdf td,
#coa-content-to-pdf label {
    font-family: 'Vazirmatn', sans-serif;
    line-height: 1.6;
    word-spacing: normal;
    letter-spacing: normal;
    white-space: normal;
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
}

/* Specific adjustments for input fields in the COA section */
#coa-content-to-pdf input[type="text"],
#coa-content-to-pdf input[type="date"] {
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
    min-height: 2.8rem;
    box-sizing: border-box;
}

/* Adjustments for the input labels in the COA info section */
.grid.grid-cols-1.md\:grid-cols-2.gap-4.mb-6.text-gray-700.text-sm .flex.items-center.gap-2 {
    align-items: flex-start;
}

/* Adjustments for the signature inputs */
.grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm .flex.flex-col.items-center {
    min-height: 5rem;
    justify-content: flex-start;
}
.grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm input[type="text"] {
    min-height: 2.8rem;
}

/* For table cells, add more padding to avoid text touching borders */
#coa-results-table-body td, #coa-results-table-body th {
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
    box-sizing: border-box;
}

/* Remove internal borders from COA table cells */
#coa-content-to-pdf table th {
    border: none;
    padding-top: 1rem;
    padding-bottom: 1rem;
    font-size: 0.95rem;
    font-weight: 700;
    background-color: #e5e7eb;
}

#coa-content-to-pdf table td {
    border: none;
}

/* Ensure the table itself has collapsed borders */
#coa-content-to-pdf table {
    border-collapse: collapse;
}

/* Specific LTR styles for the COA tab's table */
#coa-content-to-pdf table {
    direction: ltr; /* Ensure the entire table is LTR */
    text-align: left; /* Align general table content to left */
}

#coa-content-to-pdf table thead th {
    text-align: left; /* Align headers to the left within LTR table */
    direction: ltr; /* Explicitly set LTR for headers */
}

#coa-results-table-body td {
    text-align: left; /* Align body cells to the left within LTR table */
    direction: ltr; /* Explicitly set LTR for body cells */
}

</style>
</head>
<body class="bg-gray-50 text-gray-800">

<div class="container mx-auto p-4 md:p-8">

<header class="text-center mb-8">
<h1 class="text-3xl md:text-4xl font-bold text-gray-900">مونوگراف سیترات کلسیم (USP)</h1>
<p class="mt-2 text-lg text-gray-600">بررسی مشخصات دارویی طبق مونوگراف USP</p>
</header>

<nav class="mb-8 bg-white p-2 rounded-xl shadow-sm">
<div class="flex justify-center border-b border-gray-200 flex-wrap">
<button data-tab="definition" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-active">تعریف</button>
<button data-tab="identification" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">شناسایی</button>
<button data-tab="assay" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">سنجش</button>
<button data-tab="impurities" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">ناخالصی‌ها</button>
<button data-tab="specific-tests" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">آزمایشات خاص</button>
<button data-tab="packaging-storage" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">بسته‌بندی و نگهداری</button>
<button data-tab="coa" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">COA</button>
</div>
</nav>

<main>
<div id="definition" class="tab-content space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">تعریف سیترات کلسیم</h2>
<p class="text-gray-600 mb-6">این بخش شامل تعریف سیترات کلسیم و مقادیر مجاز آن است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">تعریف</h3>
<p class="text-gray-700 mb-4">سیترات کلسیم حاوی چهار مولکول آب هیدراسیون است. هنگامی که در دمای <span class="ltr-text">150°C</span> تا وزن ثابت خشک شود، حاوی حداقل <span class="ltr-text">97.5%</span> و حداکثر <span class="ltr-text">100.5%</span> از <span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span> است.</p>
<p class="text-gray-700 mt-4">فرمول شیمیایی: <span class="ltr-text">$C_{12}H_{10}Ca_{3}O_{14} \cdot 4H_{2}O$</span></p>
<p class="text-gray-700">وزن مولکولی: <span class="ltr-text">570.49</span></p>
</div>
</div>

<div id="identification" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">شناسایی</h2>
<p class="text-gray-600 mb-6">این بخش شامل معیارهای شناسایی سیترات کلسیم است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">آزمایشات شناسایی</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li><span class="font-bold">A.</span>
<ul class="list-circle list-inside ml-5">
<li>تجزیه و تحلیل: <span class="ltr-text">0.5 g</span> را در مخلوطی از <span class="ltr-text">10 mL</span> آب و <span class="ltr-text">2.5 mL</span> اسید نیتریک <span class="ltr-text">2 N</span> حل کنید. <span class="ltr-text">1 mL</span> از <span class="ltr-text">TS</span> سولفات جیوه را اضافه کنید، تا نقطه جوش حرارت دهید و <span class="ltr-text">1 mL</span> از <span class="ltr-text">TS</span> پرمنگنات پتاسیم را اضافه کنید.</li>
<li>معیار پذیرش: یک رسوب سفید تشکیل می‌شود.</li>
</ul>
</li>
<li><span class="font-bold">B.</span>
<ul class="list-circle list-inside ml-5">
<li>نمونه: <span class="ltr-text">0.5 g</span> سیترات کلسیم</li>
<li>تجزیه و تحلیل: نمونه را در کمترین دمای ممکن به طور کامل بسوزانید، خنک کنید و با اسید استیک رقیق شده (<span class="ltr-text">1:10</span>) حل کنید. فیلتر کنید و <span class="ltr-text">10 mL</span> از <span class="ltr-text">TS</span> اگزالات آمونیوم را به فیلتر اضافه کنید.</li>
<li>معیار پذیرش: یک رسوب سفید حجیم که در اسید کلریدریک محلول است، تشکیل می‌شود.</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="assay" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">سنجش</h2>
<p class="text-gray-600 mb-6">این بخش جزئیات روش سنجش برای تعیین مقدار <span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span> در سیترات کلسیم را توضیح می‌دهد. می‌توانید مقادیر را برای محاسبه درصد وارد کنید.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">روش کار:</h3>
<p class="text-gray-700 mb-4">محلول نمونه: <span class="ltr-text">350 mg</span> سیترات کلسیم را که قبلاً در دمای <span class="ltr-text">150°C</span> تا وزن ثابت خشک شده است، در <span class="ltr-text">12 mL</span> اسید کلریدریک <span class="ltr-text">0.5 M</span> حل کنید و با آب تا حدود <span class="ltr-text">100 mL</span> رقیق کنید.</p>
<p class="text-gray-700 mb-4">تجزیه و تحلیل: در حالی که محلول نمونه را هم می‌زنید، <span class="ltr-text">30 mL</span> از <span class="ltr-text">0.05 M</span> تیترانت ادتات دی‌سدیم <span class="ltr-text">VS</span> را از یک بورت <span class="ltr-text">50 mL</span> اضافه کنید. <span class="ltr-text">15 mL</span> از هیدروکسید سدیم <span class="ltr-text">1 N</span> و <span class="ltr-text">300 mg</span> هیدروکسی نفتول بلو را اضافه کنید و تیترسنجی را تا نقطه پایانی آبی ادامه دهید. هر <span class="ltr-text">mL</span> از <span class="ltr-text">0.05 M</span> ادتات دی‌سدیم معادل <span class="ltr-text">8.307 mg</span> سیترات کلسیم (<span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span>) است.</p>

<h4 class="font-bold text-gray-800 mt-6 mb-2">محاسبه درصد <span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span>:</h4>
<p class="font-mono text-center text-lg mb-4">$$Result = \frac{V \times F}{W_{sample}} \times 100$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$V$ = حجم <span class="ltr-text">0.05 M</span> تیترانت ادتات دی‌سدیم مصرفی (<span class="ltr-text">mL</span>)</li>
<li>$F$ = فاکتور معادل، <span class="ltr-text">8.307 mg $Ca_{3}(C_{6}H_{5}O_{7})_{2}$/mL</span></li>
<li>$W_{sample}$ = وزن نمونه سیترات کلسیم گرفته شده (<span class="ltr-text">mg</span>)</li>
</ul>

<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="assayV">\(V\):</label>
<input class="math-input" id="assayV" type="number" value="">
</div>
<div class="math-input-group">
<label for="assayF">\(F\):</label>
<input class="math-input" id="assayF" type="number" value="8.307" readonly>
</div>
<div class="math-input-group">
<label for="assayWsample">\(W_{sample}\):</label>
<input class="math-input" id="assayWsample" type="number" value="350" readonly>
</div>
<button onclick="calculateAssay()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه سنجش</button>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه سنجش: <span id="assayResult" class="font-bold text-blue-700">--</span>%</p>
</div>
<p class="text-gray-700 mt-4">معیار پذیرش: <span class="ltr-text">97.5%-100.5%</span> بر اساس ماده خشک.</p>
</div>
</div>

<div id="impurities" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">ناخالصی‌ها</h2>
<p class="text-gray-600 mb-6">این بخش شامل آزمایشات مربوط به ناخالصی‌ها در سیترات کلسیم است.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div class="card">
<h3 class="text-xl font-bold mb-4">آرسنیک، روش I (<a href="General chapters/〈211〉 ARSENIC.pdf" class="text-blue-600 hover:underline" target="_blank">211</a>)</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>تهیه آزمایش: <span class="ltr-text">1 g</span> سیترات کلسیم را در <span class="ltr-text">5 mL</span> اسید کلریدریک <span class="ltr-text">3 N</span> حل کنید و با آب تا <span class="ltr-text">35 mL</span> رقیق کنید.</li>
<li>معیار پذیرش: <span class="ltr-text">NMT 3 ppm</span></li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="arsenicInput">نتیجه آرسنیک:</label>
        <select class="math-input" id="arsenicInput" onchange="updateCOAImpurityResult('arsenic', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
</div>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">سرب (<a href="General chapters/〈251〉 LEAD.pdf" class="text-blue-600 hover:underline" target="_blank">251</a>)</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>تهیه آزمایش: <span class="ltr-text">0.5 g</span> سیترات کلسیم را در <span class="ltr-text">20 mL</span> اسید کلریدریک <span class="ltr-text">3 N</span> حل کنید. این محلول را روی حمام بخار تا <span class="ltr-text">10 mL</span> تبخیر کنید، با آب تا <span class="ltr-text">20 mL</span> رقیق کنید و خنک کنید. برای آزمایش از <span class="ltr-text">5 mL</span> محلول استاندارد سرب رقیق شده (<span class="ltr-text">5 µg</span> سرب) استفاده کنید.</li>
<li>معیار پذیرش: <span class="ltr-text">NMT 10 ppm</span></li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="leadInput">نتیجه سرب:</label>
        <select class="math-input" id="leadInput" onchange="updateCOAImpurityResult('lead', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
</div>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">حد فلوراید</h3>
<p class="text-gray-700 mb-4">[توجه—تمام محلول‌ها را در ظروف پلاستیکی تهیه و نگهداری کنید.]</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول ذخیره استاندارد:</span> <span class="ltr-text">1000 µg/mL</span> یون فلوراید از <span class="ltr-text">USP Sodium Fluoride RS</span> در آب.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول استاندارد:</span> <span class="ltr-text">5 µg/mL</span> یون فلوراید از محلول ذخیره استاندارد. [توجه—در روز استفاده تهیه شود.]</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن A:</span> <span class="ltr-text">1.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید. <span class="ltr-text">50 mL</span> آب، <span class="ltr-text">5 mL</span> اسید کلریدریک <span class="ltr-text">1 N</span>، <span class="ltr-text">10 mL</span> سیترات سدیم <span class="ltr-text">1.0 M</span> و <span class="ltr-text">10 mL</span> ادتات دی‌سدیم <span class="ltr-text">0.2 M</span> را اضافه کنید. در صورت لزوم، با هیدروکسید سدیم <span class="ltr-text">1 N</span> یا اسید کلریدریک <span class="ltr-text">1 N</span> تا <span class="ltr-text">pH 5.5</span> تنظیم کنید. به یک فلاسک حجمی <span class="ltr-text">100-mL</span> منتقل کرده و با آب به حجم برسانید. این محلول حاوی <span class="ltr-text">0.05 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن B:</span> <span class="ltr-text">5.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و طبق دستورالعمل محلول خطی بودن A از "اضافه کردن <span class="ltr-text">50 mL</span> آب" ادامه دهید. این محلول حاوی <span class="ltr-text">0.25 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن C:</span> <span class="ltr-text">10.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و طبق دستورالعمل محلول خطی بودن A از "اضافه کردن <span class="ltr-text">50 mL</span> آب" ادامه دهید. این محلول حاوی <span class="ltr-text">0.50 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول نمونه:</span> <span class="ltr-text">1.0 g</span> سیترات کلسیم را به یک بشر <span class="ltr-text">100-mL</span> منتقل کنید. <span class="ltr-text">10 mL</span> آب اضافه کنید و در حین هم زدن، <span class="ltr-text">10 mL</span> اسید کلریدریک <span class="ltr-text">1 N</span> را اضافه کنید. پس از حل شدن، به سرعت به مدت <span class="ltr-text">1 min</span> بجوشانید، محلول را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کرده و در آب یخ خنک کنید. <span class="ltr-text">15 mL</span> سیترات سدیم <span class="ltr-text">1.0 M</span> و <span class="ltr-text">10 mL</span> ادتات دی‌سدیم <span class="ltr-text">0.2 M</span> را اضافه کنید و با هیدروکسید سدیم <span class="ltr-text">1 N</span> یا اسید کلریدریک <span class="ltr-text">1 N</span> تا <span class="ltr-text">pH 5.5</span> تنظیم کنید. این محلول را به یک فلاسک حجمی <span class="ltr-text">100-mL</span> منتقل کرده و با آب به حجم برسانید.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">سیستم الکترود:</span> از یک الکترود یون-انتخابی فلوراید و یک الکترود مرجع نقره-نقره کلرید متصل به یک pH متر با قابلیت اندازه‌گیری پتانسیل‌ها با حداقل تکرارپذیری <span class="ltr-text">±0.2 mV</span> استفاده کنید (به pH (<a href="General chapters/〈791〉 pH.pdf" class="text-blue-600 hover:underline" target="_blank">791</a>) مراجعه کنید).</p>
<p class="text-gray-700 mb-4"><span class="font-bold">تجزیه و تحلیل:</span></p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
    <li>نمونه‌ها: محلول خطی بودن A، محلول خطی بودن B، محلول خطی بودن C و محلول نمونه</li>
    <li><span class="ltr-text">50 mL</span> از هر یک از محلول‌های خطی بودن A، B و C را به بشرهای پلاستیکی <span class="ltr-text">250-mL</span> جداگانه منتقل کنید و پتانسیل هر محلول را با سیستم الکترود اندازه‌گیری کنید. بین هر بار خواندن، الکترودها را با آب بشویید و هرگونه آب باقیمانده را با خشک کردن الکترودها جذب کنید. لگاریتم غلظت‌های فلوراید (<span class="ltr-text">0.05، 0.25 و 0.50 µg/mL</span>، به ترتیب) را در برابر پتانسیل رسم کنید تا یک خط پاسخ استاندارد به دست آید.</li>
    <li><span class="ltr-text">50 mL</span> از محلول نمونه را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و پتانسیل را با سیستم الکترود اندازه‌گیری کنید. از پتانسیل اندازه‌گیری شده و خط پاسخ استاندارد، غلظت <span class="ltr-text">C</span>، بر حسب <span class="ltr-text">µg/mL</span> یون فلوراید در محلول نمونه را تعیین کنید. درصد فلوراید در نمونه گرفته شده را با ضرب <span class="ltr-text">C</span> در <span class="ltr-text">0.01</span> محاسبه کنید.</li>
</ul>
<p class="font-mono text-center text-lg mb-4">$$Result = C \times 0.01$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$C$ = غلظت یون فلوراید در محلول نمونه (<span class="ltr-text">$\mu g/mL$</span>)</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="fluorideC">\(C\):</label>
<input class="math-input" id="fluorideC" type="number" value="">
</div>
<button onclick="calculateFluorideLimit()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه حد فلوراید</button>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه فلوراید: <span id="fluorideResult" class="font-bold text-blue-700">--</span>%</p>
</div>
<p class="text-gray-700 mt-4">معیار پذیرش: <span class="ltr-text">NMT 0.003%</span></p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">حد مواد نامحلول در اسید</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>محلول نمونه: <span class="ltr-text">5 g</span> سیترات کلسیم را با حرارت دادن با مخلوطی از اسید کلریدریک و آب (<span class="ltr-text">10:50</span>) به مدت <span class="ltr-text">30 min</span> حل کنید.</li>
<li>تجزیه و تحلیل: باقیمانده به دست آمده را فیلتر کنید، بشویید و در دمای <span class="ltr-text">105°C</span> به مدت <span class="ltr-text">2 h</span> خشک کنید.</li>
<li>معیار پذیرش: وزن باقیمانده <span class="ltr-text">NMT 10 mg (0.2%)</span> است.</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="acidInsolubleInput">نتیجه مواد نامحلول در اسید:</label>
        <select class="math-input" id="acidInsolubleInput" onchange="updateCOAImpurityResult('acidInsoluble', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
</div>
</div>
</div>
</div>

<div id="specific-tests" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">آزمایشات خاص</h2>
<p class="text-gray-600 mb-6">این بخش شامل آزمایشات خاصی است که برای اطمینان از کیفیت و خلوص سیترات کلسیم انجام می‌شود، از جمله افت وزن در اثر خشک شدن.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div class="card">
<h3 class="text-xl font-bold mb-4">افت وزن در اثر خشک شدن (LOD) (<a href="General chapters/〈731〉 LOSS ON DRYING.pdf" class="text-blue-600 hover:underline" target="_blank">731</a>)</h3>
<p class="text-gray-700 mb-4">نمونه‌ای را در دمای <span class="ltr-text">150°C</span> به مدت <span class="ltr-text">4 h</span> خشک کنید: <span class="ltr-text">10.0%</span> تا <span class="ltr-text">13.3%</span> از وزن خود را از دست می‌دهد.</p>
<h4 class="font-bold text-gray-800 mt-6 mb-2">محاسبه افت وزن در اثر خشک شدن (LOD):</h4>
<p class="font-mono text-center text-lg mb-4">$$LOD = \frac{(W_{initial} - W_{final})}{W_{initial}} \times 100$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$W_{initial}$ = وزن اولیه نمونه (<span class="ltr-text">g</span>)</li>
<li>$W_{final}$ = وزن نهایی نمونه پس از خشک شدن (<span class="ltr-text">g</span>)</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="lodInitialWeight">\(W_{initial}\):</label>
<input class="math-input" id="lodInitialWeight" type="number" value="">
</div>
<div class="math-input-group">
<label for="lodFinalWeight">\(W_{final}\):</label>
<input class="math-input" id="lodFinalWeight" type="number" value="">
</div>
<button onclick="calculateLOD()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه LOD</button>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه LOD: <span id="lodResult" class="font-bold text-blue-700">--</span>%</p>
</div>
</div>
</div>
</div>

<div id="packaging-storage" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">بسته‌بندی و نگهداری</h2>
<p class="text-gray-600 mb-6">این بخش شامل اطلاعات مهم در مورد نحوه بسته‌بندی و نگهداری سیترات کلسیم است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">بسته‌بندی و نگهداری</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>در ظروف محکم نگهداری شود.</li>
</ul>
<h3 class="text-xl font-bold mb-4 mt-6">استانداردهای مرجع USP</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li><span class="ltr-text">USP Sodium Fluoride RS</span></li>
</ul>
</div>
</div>

<div id="coa" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">Certificate of Analysis (COA)</h2>
<p class="text-gray-600 mb-6">This section summarizes the results of tests and calculations performed according to the monograph.</p>
</div>
<div class="card" id="coa-content-to-pdf" dir="ltr">
<h3 class="text-xl font-bold mb-4">Product Information</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-gray-700 text-sm">
<div class="flex items-center gap-2">
<label for="coaProductName" class="font-bold">Product Name:</label>
<span id="coaProductNameDisplay" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100 text-gray-700">Calcium Citrate</span>
</div>
<div class="flex items-center gap-2">
<label for="coaBatchNumber" class="font-bold">Batch Number:</label>
<input type="text" id="coaBatchNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaMfgDate" class="font-bold">Mfg. Date:</label>
<input type="date" id="coaMfgDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaProductCode" class="font-bold">Product Code:</label>
<input type="text" id="coaProductCode" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaRetestDate" class="font-bold">Retest Date:</label>
<input type="date" id="coaRetestDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaAnalysisNumber" class="font-bold">Analysis Number:</label>
<input type="text" id="coaAnalysisNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
</div>

<h3 class="text-xl font-bold mb-4">Test Results</h3>
<div class="overflow-x-auto mb-6">
<table class="min-w-full bg-white border border-gray-200">
<thead class="bg-gray-100">
<tr>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Tests</th>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Specification (USP)</th>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Results</th>
</tr>
</thead>
<tbody id="coa-results-table-body">
</tbody>
</table>
</div>

<h3 class="text-xl font-bold mb-4">Signatures</h3>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-gray-700 text-sm">
<div class="flex flex-col items-center">
<label for="coaAnalyst" class="font-bold mb-1">Analyst:</label>
<input type="text" id="coaAnalyst" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
<div class="flex flex-col items-center">
<label for="coaSupervisor" class="font-bold mb-1">QC Lab Supervisor:</label>
<input type="text" id="coaSupervisor" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
<div class="flex flex-col items-center">
<label for="coaQCManager" class="font-bold mb-1">QC Manager:</label>
<input type="text" id="coaQCManager" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
</div>

<div class="flex justify-center">
<button onclick="exportCOAPDF()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-4">Save COA as PDF</button>
</div>
</div>
</div>
</main>
</div>

<script>
// Object to store calculation results for COA
let calculationResults = {
    assay: { label: 'Assay', value: '--', unit: '%', status: 'initial', spec: '97.5%-100.5%' },
    arsenic: { label: 'Arsenic', value: '', unit: '', status: 'initial', spec: 'NMT 3 ppm' },
    lead: { label: 'Lead', value: '', unit: '', status: 'initial', spec: 'NMT 10 ppm' },
    limitOfFluoride: { label: 'Limit of Fluoride', value: '--', unit: '%', status: 'initial', spec: 'NMT 0.003%' },
    acidInsoluble: { label: 'Acid-Insoluble Substances', value: '', unit: '', status: 'initial', spec: 'NMT 10 mg (0.2%)' },
    lod: { label: 'Loss on Drying (LOD)', value: '--', unit: '%', status: 'initial', spec: '10.0%-13.3%' },
};

// Function to update the COA tab content dynamically
function updateCOATab() {
    const coaResultsTableBody = document.getElementById('coa-results-table-body');
    if (!coaResultsTableBody) return; // Exit if COA table body not found

    coaResultsTableBody.innerHTML = ''; // Clear existing rows

    for (const key in calculationResults) {
        if (calculationResults.hasOwnProperty(key)) {
            const resultData = calculationResults[key];
            const tableRow = document.createElement('tr');
            let valueContent;
            let valueClass = ''; // Initialize valueClass

            // Determine content and class based on status
            if (resultData.status === 'initial' || resultData.status === 'user-entered') {
                valueContent = resultData.value; // Display the raw value from calculationResults
                valueClass = 'text-gray-700'; // Default text color for editable input
            } else if (resultData.status === 'error') {
                valueContent = resultData.value + resultData.unit;
                valueClass = 'text-red-500';
            } else { // For calculated fields (status === 'calculated')
                valueContent = resultData.value + resultData.unit;
                valueClass = 'text-blue-700';
            }

            tableRow.innerHTML = `
                <td class="py-2 px-3">${resultData.label}</td>
                <td class="py-2 px-3">${resultData.spec}</td>
                <td class="py-2 px-3 font-bold ${valueClass}">
                    <span style="display: inline-block; width: 100%; text-align: left;">
                        ${valueContent}
                    </span>
                </td>
            `;
            coaResultsTableBody.appendChild(tableRow);
        }
    }
}

// Function to update user-entered impurity results
window.updateCOAImpurityResult = function(key, value) {
    calculationResults[key].value = value;
    calculationResults[key].status = 'user-entered'; // Mark as user-entered
    updateCOATab(); // Update COA tab after any calculation
};

// Helper function to update a specific calculation result and then the COA tab
function setCalculationResult(key, value, unit = '', status = 'calculated', spec = null) {
    calculationResults[key].value = value;
    calculationResults[key].unit = unit;
    calculationResults[key].status = status;
    if (spec !== null) {
        calculationResults[key].spec = spec;
    }
    updateCOATab(); // Update COA tab after any calculation
}

// Calculation function for Assay
window.calculateAssay = function() {
    const V = parseFloat(document.getElementById('assayV').value);
    const F = parseFloat(document.getElementById('assayF').value); // Fixed at 8.307
    const W_sample = parseFloat(document.getElementById('assayWsample').value); // Fixed at 350

    const resultElement = document.getElementById('assayResult');

    if (isNaN(V) || isNaN(F) || isNaN(W_sample)) {
        resultElement.textContent = "خطا: لطفاً تمام فیلدها را با اعداد معتبر پر کنید.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('assay', 'خطا', '', 'error');
        return;
    }
    if (W_sample === 0) {
        resultElement.textContent = "خطا: وزن نمونه (W_sample) نمی‌تواند صفر باشد.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('assay', 'خطا', '', 'error');
        return;
    }

    const result = (V * F * 100) / W_sample;
    resultElement.textContent = result.toFixed(2) + '%';
    resultElement.classList.remove('text-red-500');
    resultElement.classList.add('text-blue-700');

    setCalculationResult('assay', result.toFixed(2), '%', 'calculated', '97.5%-100.5%');
};


// Calculation function for Limit of Fluoride
window.calculateFluorideLimit = function() {
    const C = parseFloat(document.getElementById('fluorideC').value);

    const resultElement = document.getElementById('fluorideResult');

    if (isNaN(C)) {
        resultElement.textContent = "خطا: لطفاً تمام فیلدها را با اعداد معتبر پر کنید.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('limitOfFluoride', 'خطا', '', 'error');
        return;
    }

    const result = C * 0.01;
    resultElement.textContent = result.toFixed(3) + '%'; // Fluoride limit is usually to 3 decimal places
    resultElement.classList.remove('text-red-500');
    resultElement.classList.add('text-blue-700');

    setCalculationResult('limitOfFluoride', result.toFixed(3), '%', 'calculated', 'NMT 0.003%');
};


// Calculation function for Loss on Drying (LOD)
window.calculateLOD = function() {
    const initialWeight = parseFloat(document.getElementById('lodInitialWeight').value);
    const finalWeight = parseFloat(document.getElementById('lodFinalWeight').value);
    const resultElement = document.getElementById('lodResult');

    if (isNaN(initialWeight) || isNaN(finalWeight)) {
        resultElement.textContent = "خطا: لطفاً تمام فیلدها را با اعداد معتبر پر کنید.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('lod', 'خطا', '', 'error');
        return;
    }
    if (initialWeight === 0) {
        resultElement.textContent = "خطا: وزن اولیه (W_initial) نمی‌تواند صفر باشد.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('lod', 'خطا', '', 'error');
        return;
    }

    const result = ((initialWeight - finalWeight) / initialWeight) * 100;
    resultElement.textContent = result.toFixed(2) + '%';
    resultElement.classList.remove('text-red-500');
    resultElement.classList.add('text-blue-700');

    setCalculationResult('lod', result.toFixed(2), '%', 'calculated', '10.0%-13.3%');
};


// Function to export COA as a PDF
window.exportCOAPDF = function() {
    const element = document.getElementById('coa-content-to-pdf');
    const exportButton = element.querySelector('button'); // Get the specific button within the COA content

    // Hide the button before capturing
    if (exportButton) {
        exportButton.style.display = 'none';
    }

    document.fonts.ready().then(() => {
        html2canvas(element, {
            scale: 3, // Increased scale for higher resolution
            logging: true,
            useCORS: true, // Important if you have images from different origins
        }).then(function(canvas) {
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf; // Get jsPDF from the global window object
            const pdf = new jsPDF('p', 'mm', 'a4'); // 'p' for portrait, 'mm' for millimeters, 'a4' for A4 size

            const imgWidth = 210; // A4 width in mm
            const pageHeight = 297; // A4 height in mm
            const imgHeight = canvas.height * imgWidth / canvas.width;
            let heightLeft = imgHeight;

            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            pdf.save(`COA_Calcium_Citrate_${new Date().toISOString().slice(0, 10)}.pdf`);

        }).catch(error => {
            console.error("Error capturing screenshot or generating PDF:", error);
            alert("خطا در گرفتن اسکرین‌شات یا تولید PDF: " + error.message);
        }).finally(() => {
            // Show the button again after capture (whether successful or not)
            if (exportButton) {
                exportButton.style.display = ''; // Reset to default display
            }
        });
    }).catch(error => {
        console.error("Font loading error:", error);
        alert("خطا در بارگذاری فونت. ممکن است PDF به درستی نمایش داده نشود.");
        // Ensure button is shown even if font loading fails
        if (exportButton) {
            exportButton.style.display = '';
        }
    });
};


document.addEventListener('DOMContentLoaded', function () {
    // Tab navigation for main tabs
    const mainTabButtons = document.querySelectorAll('nav .tab-button');
    const mainTabContents = document.querySelectorAll('main > .tab-content');

    mainTabButtons.forEach(button => {
        button.addEventListener('click', function() {
            mainTabButtons.forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            this.classList.add('tab-active');
            this.classList.remove('tab-inactive');

            mainTabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(this.dataset.tab).classList.remove('hidden');

            // Re-run MathJax on the newly loaded content
            if (typeof MathJax !== 'undefined') {
                MathJax.typeset([document.getElementById(this.dataset.tab)]);
            }

            // If COA tab is clicked, update its content
            if (this.dataset.tab === 'coa') {
                updateCOATab(); // Refresh COA tab content
            }
        });
    });

    // Initial MathJax typesetting for the default visible tab (definition)
    if (typeof MathJax !== 'undefined') {
        MathJax.typeset([document.getElementById('definition')]);
    }

    // Initial update of COA tab content on page load
    updateCOATab();
});
</script>
</body>
</html>
