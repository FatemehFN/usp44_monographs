<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مونوگراف آدیپیک اسید (USP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Include FileSaver.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
            word-spacing: normal;
            letter-spacing: normal;
        }
        .tab-active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
        .tab-inactive { border-color: transparent; color: #6b7280; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-right: auto; margin-left: auto; height: 350px; max-height: 40vh; }
        table {
            direction: rtl;
            text-align: right;
        }
        th {
            text-align: right;
            vertical-align: top;
        }
        td {
            text-align: right;
            vertical-align: middle;
        }

        /* Ensure vertical alignment for all headers in COA table */
        #coa-content-to-pdf table thead th {
            vertical-align: top !important;
        }

        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            line-height: inherit;
            word-spacing: inherit;
            letter-spacing: inherit;
            white-space: normal;
        }
        .ltr-text {
            direction: ltr;
            display: inline-block;
            unicode-bidi: isolate;
        }
        .math-input {
            appearance: none;
            -moz-appearance: textfield;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            width: 100px;
            text-align: left;
            direction: ltr;
        }
        .math-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* Styles for the COA tab content container */
        #coa {
            direction: ltr !important; /* Force LTR for the entire COA tab content */
            text-align: left !important; /* Force left alignment for COA tab content */
        }

        #coa-content-to-pdf {
            direction: ltr;
            text-align: left;
            padding: 1.5rem;
        }
        #coa-content-to-pdf p,
        #coa-content-to-pdf h1,
        #coa-content-to-pdf h2,
        #coa-content-to-pdf h3,
        #coa-content-to-pdf th,
        #coa-content-to-pdf td,
        #coa-content-to-pdf label {
            font-family: 'Vazirmatn', sans-serif;
            line-height: 1.6;
            word-spacing: normal;
            letter-spacing: normal;
            white-space: normal;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }
        #coa-content-to-pdf input[type="text"],
        #coa-content-to-pdf input[type="date"] {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            min-height: 2.8rem;
            box-sizing: border-box;
        }
        .grid.grid-cols-1.md\:grid-cols-2.gap-4.mb-6.text-gray-700.text-sm .flex.items-center.gap-2 {
            align-items: flex-start;
        }
        .grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm .flex.flex-col.items-center {
            min-height: 5rem;
            justify-content: flex-start;
        }
        .grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm input[type="text"] {
            min-height: 2.8rem;
        }
        #coa-results-table-body td, #coa-results-table-body th {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            box-sizing: border-box;
        }
        #coa-content-to-pdf table th {
            border: none;
            padding-top: 1rem;
            padding-bottom: 1rem;
            font-size: 0.95rem;
            font-weight: 700;
            background-color: #e5e7eb;
        }
        #coa-content-to-pdf table td {
            border: none;
        }
        #coa-content-to-pdf table {
            border-collapse: collapse;
            /* Explicitly force LTR for the entire table */
            direction: ltr !important;
            text-align: left !important;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">مونوگراف آدیپیک اسید (USP)</h1>
            <p class="mt-2 text-lg text-gray-600">بررسی مشخصات دارویی طبق مونوگراف USP</p>
        </header>

        <nav class="mb-8 bg-white p-2 rounded-xl shadow-sm">
            <div class="flex justify-center border-b border-gray-200 flex-wrap">
                <button data-tab="definition" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-active">تعریف</button>
                <button data-tab="identification" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">شناسایی</button>
                <button data-tab="assay" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">سنجش</button>
                <button data-tab="impurities" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">ناخالصی‌ها</button>
                <button data-tab="specific-tests" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">آزمایشات خاص</button>
                <button data-tab="additional-requirements" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">الزامات اضافی</button>
                <button data-tab="moa" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">MOA</button>
                <button data-tab="coa" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">COA</button>
            </div>
        </nav>

        <main>
            <div id="definition" class="tab-content space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">تعریف آدیپیک اسید</h2>
                    <p class="text-gray-600 mb-6">آدیپیک اسید حاوی حداقل <span class="ltr-text">99.0%</span> و حداکثر <span class="ltr-text">101.0%</span> از <span class="ltr-text">$C_{6}H_{10}O_{4}$</span>، محاسبه شده بر اساس ماده خشک است.</p>
                    <p class="text-gray-700 mt-4">نام شیمیایی: هگزان‌دیوئیک اسید؛ <span class="ltr-text">1,4-Butanedicarboxylic acid [124-04-9]</span>.</p>
                    <p class="text-gray-700">فرمول شیمیایی: <span class="ltr-text">$C_{6}H_{10}O_{4}$</span></p>
                    <p class="text-gray-700">وزن مولکولی: <span class="ltr-text">146.14</span></p>
                </div>
            </div>

            <div id="identification" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">شناسایی</h2>
                    <p class="text-gray-600 mb-6">این بخش شامل معیارهای شناسایی آدیپیک اسید است.</p>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">A. آزمایشات شناسایی طیف‌سنجی (<a href="General chapters/〈197〉 SPECTROSCOPIC IDENTIFICATION TESTS.pdf" class="text-blue-600 hover:underline" target="_blank">197</a>)، طیف‌سنجی فروسرخ:</h3>
                    <p class="text-gray-700">معیار پذیرش: <span class="ltr-text">197K</span></p>
                    <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                        <div class="math-input-group">
                            <label for="irIdentificationInput">نتیجه شناسایی IR:</label>
                            <select class="math-input" id="irIdentificationInput" onchange="updateCOAImpurityResult('irIdentification', this.value)">
                                <option value="">---</option>
                                <option value="Pass">Pass</option>
                                <option value="Fail">Fail</option>
                            </select>
                        </div>
                        <div class="math-input-group">
                            <label for="irIdentificationAdditionalSpec">مشخصات اضافی:</label>
                            <input class="math-input" id="irIdentificationAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('irIdentification', this.value)">
                        </div>
                    </div>
                </div>
            </div>

            <div id="assay" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">سنجش</h2>
                    <p class="text-gray-600 mb-6">این بخش جزئیات روش سنجش برای تعیین مقدار آدیپیک اسید (<span class="ltr-text">$C_{6}H_{10}O_{4}$</span>) را توضیح می‌دهد. می‌توانید مقادیر را برای محاسبه درصد وارد کنید.</p>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">روش کار:</h3>
                    <p class="text-gray-700 mb-4">نمونه: <span class="ltr-text">60 mg</span></p>
                    <p class="text-gray-700 mb-2"><span class="font-bold">سیستم تیترسنجی:</span> (به تیترسنجی (<a href="General chapters/〈541〉 TITRIMETRY.pdf" class="text-blue-600 hover:underline" target="_blank">541</a>) مراجعه کنید.)</p>
                    <ul class="list-circle list-inside ml-5">
                        <li>حالت: تیترسنجی مستقیم</li>
                        <li>تیترانت: <span class="ltr-text">0.1 N</span> هیدروکسید سدیم <span class="ltr-text">VS</span></li>
                        <li>بلانک: <span class="ltr-text">50.0 mL</span> آب</li>
                        <li>تشخیص نقطه پایانی: رنگ‌سنجی</li>
                    </ul>
                    <p class="text-gray-700 mb-4"><span class="font-bold">تجزیه و تحلیل:</span> نمونه را در <span class="ltr-text">50 mL</span> آب حل کنید. <span class="ltr-text">0.2 mL</span> از <span class="ltr-text">TS</span> فنل‌فتالئین را اضافه کنید و با <span class="ltr-text">0.1 N</span> هیدروکسید سدیم <span class="ltr-text">VS</span> تا نقطه پایانی صورتی کم‌رنگ دائمی تیتر کنید. تعیین بلانک را انجام دهید. درصد آدیپیک اسید (<span class="ltr-text">$C_{6}H_{10}O_{4}$</span>) را در نمونه گرفته شده محاسبه کنید:</p>
                    <p class="font-mono text-center text-lg mb-4">$$Result = [(V-B) \times N \times F \times 100] / W$$</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
                        <li>$V$ = حجم تیترانت مصرفی توسط نمونه (<span class="ltr-text">mL</span>)</li>
                        <li>$B$ = حجم تیترانت مصرفی توسط بلانک (<span class="ltr-text">mL</span>)</li>
                        <li>$N$ = نرمالیته واقعی تیترانت (<span class="ltr-text">mEq/mL</span>)</li>
                        <li>$F$ = فاکتور معادل، <span class="ltr-text">73.1 mg/mEq</span></li>
                        <li>$W$ = وزن نمونه (<span class="ltr-text">mg</span>)</li>
                    </ul>
                    <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
                        <div class="math-input-group">
                            <label for="assayV">\(V\):</label>
                            <input class="math-input" id="assayV" type="number" value="">
                        </div>
                        <div class="math-input-group">
                            <label for="assayB">\(B\):</label>
                            <input class="math-input" id="assayB" type="number" value="">
                        </div>
                        <div class="math-input-group">
                            <label for="assayN">\(N\):</label>
                            <input class="math-input" id="assayN" type="number" value="">
                        </div>
                        <div class="math-input-group">
                            <label for="assayF">\(F\):</label>
                            <input class="math-input" id="assayF" type="number" value="73.1" readonly>
                        </div>
                        <div class="math-input-group">
                            <label for="assayW">\(W\):</label>
                            <input class="math-input" id="assayW" type="number" value="">
                        </div>
                        <button onclick="calculateAssay()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه سنجش</button>
                        <div class="math-input-group">
                            <label for="assayAdditionalSpec">مشخصات اضافی:</label>
                            <input class="math-input" id="assayAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('assay', this.value)">
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <p class="text-gray-700">نتیجه سنجش: <span id="assayResult" class="font-bold text-blue-700">--</span>%</p>
                        <p class="text-gray-700">نتیجه سنجش به ppm: <span id="assayResultPPM" class="font-bold text-blue-700">--</span> ppm</p>
                    </div>
                    <p class="text-gray-700 mt-4">معیار پذیرش: <span class="ltr-text">99.0%-101.0%</span> بر اساس ماده خشک.</p>
                </div>
            </div>

            <div id="impurities" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">ناخالصی‌ها</h2>
                    <p class="text-gray-600 mb-6">این بخش شامل آزمایشات مربوط به ناخالصی‌ها در آدیپیک اسید است.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">باقی‌مانده پس از احتراق (<a href="General chapters/〈281〉 RESIDUE ON IGNITION.pdf" class="text-blue-600 hover:underline" target="_blank">281</a>)</h3>
                        <p class="text-gray-700">معیار پذیرش: <span class="ltr-text">NMT 0.1%</span></p>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="roiInput">نتیجه باقی‌مانده پس از احتراق:</label>
                                <select class="math-input" id="roiInput" onchange="updateCOAImpurityResult('residueOnIgnition', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="roiAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="roiAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('residueOnIgnition', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">حد نیترات‌ها</h3>
                        <p class="text-gray-700 mb-2"><span class="font-bold">محلول ذخیره استاندارد:</span> <span class="ltr-text">1.63 mg/mL</span> نیترات پتاسیم</p>
                        <p class="text-gray-700 mb-2"><span class="font-bold">محلول استاندارد:</span> <span class="ltr-text">1 mL</span> از محلول ذخیره استاندارد را با آب تا <span class="ltr-text">10 mL</span> رقیق کنید. <span class="ltr-text">1 mL</span> از این محلول را با آب تا <span class="ltr-text">50 mL</span> رقیق کنید تا محلولی حاوی <span class="ltr-text">2 µg/mL</span> نیترات به دست آید. تمام محلول‌های نیترات را در ظروف پلاستیکی تهیه و نگهداری کنید.</p>
                        <p class="text-gray-700 mb-2"><span class="font-bold">کنترل:</span> <span class="ltr-text">2 mg/L</span> پرمنگنات پتاسیم</p>
                        <p class="text-gray-700 mb-4"><span class="font-text">تجزیه و تحلیل:</span> <span class="ltr-text">1.0 mL</span> از محلول نمونه، <span class="ltr-text">1.5 mL</span> از محلول استاندارد و <span class="ltr-text">1 mL</span> آب (بلانک) را به سه فلاسک جداگانه منتقل کنید. به هر فلاسک <span class="ltr-text">2 mL</span> آمونیاک غلیظ، <span class="ltr-text">0.5 mL</span> سولفات منگنز <span class="ltr-text">10 mg/mL</span> و <span class="ltr-text">1 mL</span> سولفانیل‌آمید <span class="ltr-text">0 mg/mL</span> را اضافه کنید و هر محلول را با آب تا <span class="ltr-text">20 mL</span> رقیق کنید. <span class="ltr-text">100 mg</span> پودر روی را به هر سه فلاسک اضافه کنید و به مدت <span class="ltr-text">30 min</span> در حمام یخ خنک کنید، محلول‌ها را به صورت دوره‌ای تکان دهید. به صورت جداگانه <span class="ltr-text">10 mL</span> از هر محلول را فیلتر کنید، در حمام یخ خنک کنید، سپس <span class="ltr-text">2.5 mL</span> اسید کلریدریک و <span class="ltr-text">1 mL</span> دی‌هیدروکلرید نفتیل‌اتیلن‌دی‌آمین <span class="ltr-text">10 mg/mL</span> را اضافه کنید. اجازه دهید محلول‌ها به مدت <span class="ltr-text">15 min</span> در دمای اتاق بمانند. مناسب بودن سیستم: آزمایش نامعتبر است اگر محلول بلانک تهیه شده همزمان تیره‌تر از کنترل باشد.</p>
                        <p class="text-gray-700 mt-4">معیار پذیرش: رنگ محلول حاوی محلول نمونه تیره‌تر از محلول تهیه شده همزمان حاوی محلول استاندارد (<span class="ltr-text">NMT 30 ppm</span>) نیست.</p>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="nitratesInput">نتیجه حد نیترات‌ها:</label>
                                <select class="math-input" id="nitratesInput" onchange="updateCOAImpurityResult('nitrates', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="nitratesAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="nitratesAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('nitrates', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">کلرید و سولفات، کلرید (<a href="General chapters/〈221〉 CHLORIDE AND SULFATE.pdf" class="text-blue-600 hover:underline" target="_blank">221</a>)</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>نمونه: یک بخش <span class="ltr-text">5-mL</span> از محلول نمونه از حد نیترات‌ها.</li>
                            <li>تجزیه و تحلیل: طبق دستورالعمل فصل عمل کنید.</li>
                            <li>معیار پذیرش: نمونه بیش از کلرید معادل <span class="ltr-text">0.14-mL</span> اسید کلریدریک <span class="ltr-text">0.020 N</span> (<span class="ltr-text">NMT 0.02%</span>) را نشان نمی‌دهد.</li>
                        </ul>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="chlorideInput">نتیجه کلرید:</label>
                                <select class="math-input" id="chlorideInput" onchange="updateCOAImpurityResult('chloride', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="chlorideAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="chlorideAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('chloride', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">کلرید و سولفات، سولفات (<a href="General chapters/〈221〉 CHLORIDE AND SULFATE.pdf" class="text-blue-600 hover:underline" target="_blank">221</a>)</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>نمونه: یک بخش <span class="ltr-text">5-mL</span> از محلول نمونه از حد نیترات‌ها.</li>
                            <li>تجزیه و تحلیل: طبق دستورالعمل فصل عمل کنید.</li>
                            <li>معیار پذیرش: نمونه بیش از سولفات معادل <span class="ltr-text">0.26-mL</span> اسید سولفوریک <span class="ltr-text">0.020 N</span> (<span class="ltr-text">NMT 0.05%</span>) را نشان نمی‌دهد.</li>
                        </ul>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="sulfateInput">نتیجه سولفات:</label>
                                <select class="math-input" id="sulfateInput" onchange="updateCOAImpurityResult('sulfate', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="sulfateAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="sulfateAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('sulfate', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">آهن (<a href="General chapters/〈241〉 IRON.pdf" class="text-blue-600 hover:underline" target="_blank">241</a>)</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>نمونه: یک بخش <span class="ltr-text">10-mL</span> از محلول نمونه از حد نیترات‌ها.</li>
                            <li>تجزیه و تحلیل: طبق دستورالعمل فصل عمل کنید.</li>
                            <li>معیار پذیرش: <span class="ltr-text">NMT 10 ppm</span></li>
                        </ul>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="ironInput">نتیجه آهن:</label>
                                <select class="math-input" id="ironInput" onchange="updateCOAImpurityResult('iron', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="ironAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="ironAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('iron', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="specific-tests" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">آزمایشات خاص</h2>
                    <p class="text-gray-600 mb-6">این بخش شامل آزمایشات خاصی است که برای اطمینان از کیفیت و خلوص آدیپیک اسید انجام می‌شود.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">محدوده ذوب یا دما (<a href="General chapters/〈741〉 MELTING RANGE OR TEMPERATURE.pdf" class="text-blue-600 hover:underline" target="_blank">741</a>)</h3>
                        <p class="text-gray-700">معیار پذیرش: <span class="ltr-text">151°C-154°C</span></p>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
                            <div class="math-input-group">
                                <label for="meltingRangeInput">نتیجه محدوده ذوب:</label>
                                <select class="math-input" id="meltingRangeInput" onchange="updateCOAImpurityResult('meltingRange', this.value)">
                                    <option value="">---</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="math-input-group">
                                <label for="meltingRangeAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="meltingRangeAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('meltingRange', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4">افت وزن در اثر خشک شدن (LOD) (<a href="General chapters/〈731〉 LOSS ON DRYING.pdf" class="text-blue-600 hover:underline" target="_blank">731</a>)</h3>
                        <p class="text-gray-700 mb-4">نمونه‌ای را در دمای <span class="ltr-text">105°C</span> تا وزن ثابت خشک کنید؛ بیش از <span class="ltr-text">0.2%</span> از وزن خود را از دست نمی‌دهد.</p>
                        <h4 class="font-bold text-gray-800 mt-6 mb-2">محاسبه افت وزن در اثر خشک شدن (LOD):</h4>
                        <p class="font-mono text-center text-lg mb-4">$$LOD = \frac{(W_{initial} - W_{final})}{W_{initial}} \times 100$$</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
                            <li>$W_{initial}$ = وزن اولیه نمونه (<span class="ltr-text">g</span>)</li>
                            <li>$W_{final}$ = وزن نهایی نمونه پس از خشک شدن (<span class="ltr-text">g</span>)</li>
                        </ul>
                        <div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
                            <div class="math-input-group">
                                <label for="lodInitialWeight">\(W_{initial}\):</label>
                                <input class="math-input" id="lodInitialWeight" type="number" value="">
                            </div>
                            <div class="math-input-group">
                                <label for="lodFinalWeight">\(W_{final}\):</label>
                                <input class="math-input" id="lodFinalWeight" type="number" value="">
                            </div>
                            <button onclick="calculateLOD()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه LOD</button>
                            <div class="math-input-group">
                                <label for="lodAdditionalSpec">مشخصات اضافی:</label>
                                <input class="math-input" id="lodAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('lod', this.value)">
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <p class="text-gray-700">نتیجه LOD: <span id="lodResult" class="font-bold text-blue-700">--</span>%</p>
                            <p class="text-gray-700">نتیجه LOD به ppm: <span id="lodResultPPM" class="font-bold text-blue-700">--</span> ppm</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="additional-requirements" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">الزامات اضافی</h2>
                    <p class="text-gray-600 mb-6">این بخش شامل اطلاعات مهم در مورد بسته‌بندی و نگهداری آدیپیک اسید است.</p>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">بسته‌بندی و نگهداری</h3>
                    <ul class="list-disc list-inside text-gray-700">
                        <li>در ظروف محکم نگهداری شود.</li>
                        <li>هیچ الزامات نگهداری مشخصی وجود ندارد.</li>
                    </ul>
                    <h3 class="text-xl font-bold mb-4 mt-6">استانداردهای مرجع USP (<a href="General chapters/〈11〉 USP REFERENCE STANDARDS.pdf" class="text-blue-600 hover:underline" target="_blank">11</a>)</h3>
                    <ul class="list-circle list-inside text-gray-700">
                        <li><span class="ltr-text">USP Adipic Acid RS</span></li>
                    </ul>
                </div>
            </div>

            <div id="moa" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">روش تجزیه و تحلیل (MOA)</h2>
                    <p class="text-gray-600 mb-6">این بخش اطلاعات روش تجزیه و تحلیل را از تمام بخش‌های مونوگراف گردآوری می‌کند.</p>
                    <button onclick="generateMOADocument()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">تولید سند MOA (Word)</button>
                </div>
            </div>

            <div id="coa" class="tab-content hidden space-y-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800" style="text-align: left; direction: ltr;">Certificate of Analysis (COA)</h2>
                    <p class="text-gray-600 mb-6" style="text-align: left; direction: ltr;">This section summarizes the results of tests and calculations performed according to the monograph.</p>
                </div>
                <div class="card" id="coa-content-to-pdf" dir="ltr">
                    <h3 class="text-xl font-bold mb-4">Product Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-gray-700 text-sm">
                        <div class="flex items-center gap-2">
                            <label for="coaProductName" class="font-bold">Product Name:</label>
                            <span id="coaProductNameDisplay" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100 text-gray-700">Adipic Acid</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="coaBatchNumber" class="font-bold">Batch Number:</label>
                            <input type="text" id="coaBatchNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="coaMfgDate" class="font-bold">Mfg. Date:</label>
                            <input type="date" id="coaMfgDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="coaProductCode" class="font-bold">Product Code:</label>
                            <input type="text" id="coaProductCode" class="w-full p-2 border border-gray-300 rounded-md" value="">
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="coaRetestDate" class="font-bold">Retest Date:</label>
                            <input type="date" id="coaRetestDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="coaAnalysisNumber" class="font-bold">Analysis Number:</label>
                            <input type="text" id="coaAnalysisNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mb-4">Test Results</h3>
                    <div class="overflow-x-auto mb-6">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Tests</th>
                                    <th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Pharmacopoeia (USP 44)</th>
                                    <th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Additional Specifications</th>
                                    <th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Results</th>
                                </tr>
                            </thead>
                            <tbody id="coa-results-table-body">
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-xl font-bold mb-4">Signatures</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-gray-700 text-sm">
                        <div class="flex flex-col items-center">
                            <label for="coaAnalyst" class="font-bold mb-1">Analyst:</label>
                            <input type="text" id="coaAnalyst" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
                        </div>
                        <div class="flex flex-col items-center">
                            <label for="coaSupervisor" class="font-bold mb-1">QC Lab Supervisor:</label>
                            <input type="text" id="coaSupervisor" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
                        </div>
                        <div class="flex flex-col items-center">
                            <label for="coaQCManager" class="font-bold mb-1">QC Manager:</label>
                            <input type="text" id="coaQCManager" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
                        </div>
                    </div>

                    <div class="flex justify-center">
                        <button onclick="exportCOAPDF()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-4">Save COA as PDF</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Object to store calculation results for COA
        let calculationResults = {
            assay: { label: 'Assay', value: '--', unit: '%', status: 'initial', spec: '99.0%-101.0%', additionalSpec: '' },
            irIdentification: { label: 'IR Identification', value: '', unit: '', status: 'initial', spec: '197K', additionalSpec: '' },
            residueOnIgnition: { label: 'Residue on Ignition', value: '', unit: '%', status: 'initial', spec: 'NMT 0.1%', additionalSpec: '' },
            nitrates: { label: 'Limit of Nitrates', value: '', unit: '', status: 'initial', spec: 'NMT 30 ppm', additionalSpec: '' },
            chloride: { label: 'Chloride', value: '', unit: '%', status: 'initial', spec: 'NMT 0.02%', additionalSpec: '' },
            sulfate: { label: 'Sulfate', value: '', unit: '%', status: 'initial', spec: 'NMT 0.05%', additionalSpec: '' },
            iron: { label: 'Iron', value: '', unit: ' ppm', status: 'initial', spec: 'NMT 10 ppm', additionalSpec: '' },
            meltingRange: { label: 'Melting Range or Temperature', value: '', unit: '°C', status: 'initial', spec: '151°C-154°C', additionalSpec: '' },
            lod: { label: 'Loss on Drying (LOD)', value: '--', unit: '%', status: 'initial', spec: 'NMT 0.2%', additionalSpec: '' },
        };

        // Function to update the COA tab content dynamically
        function updateCOATab() {
            const coaResultsTableBody = document.getElementById('coa-results-table-body');
            if (!coaResultsTableBody) return;

            coaResultsTableBody.innerHTML = '';

            for (const key in calculationResults) {
                if (calculationResults.hasOwnProperty(key)) {
                    const resultData = calculationResults[key];
                    const tableRow = document.createElement('tr');
                    let valueContent;
                    let valueClass = '';

                    if (resultData.status === 'initial' || resultData.status === 'user-entered') {
                        valueContent = resultData.value;
                        valueClass = 'text-gray-700';
                    } else if (resultData.status === 'error') {
                        valueContent = resultData.value + resultData.unit;
                        valueClass = 'text-red-500';
                    } else { // 'calculated'
                        valueContent = resultData.value + resultData.unit;
                        valueClass = 'text-blue-700';
                    }

                    tableRow.innerHTML = `
                        <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.label}</td>
                        <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.spec}</td>
                        <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.additionalSpec}</td>
                        <td class="py-2 px-3 font-bold ${valueClass}">
                            <span style="display: inline-block; width: 100%; text-align: left;">
                                ${valueContent}
                            </span>
                        </td>
                    `;
                    coaResultsTableBody.appendChild(tableRow);
                }
            }
        }

        // Function to update user-entered impurity results
        window.updateCOAImpurityResult = function(key, value) {
            calculationResults[key].value = value;
            calculationResults[key].status = 'user-entered';
            updateCOATab();
        };

        // Function to update additional specifications
        window.updateCOAAdditionalSpec = function(key, value) {
            calculationResults[key].additionalSpec = value;
            updateCOATab(); // Update COA tab to reflect the new additional spec
        };


        // Helper function to update a specific calculation result and then the COA tab
        function setCalculationResult(key, value, unit = '', status = 'calculated', spec = null) {
            calculationResults[key].value = value;
            calculationResults[key].unit = unit;
            calculationResults[key].status = status;
            if (spec !== null) {
                calculationResults[key].spec = spec;
            }
            updateCOATab();
        };

        // Calculation function for Assay
window.calculateAssay = function() {
    const V = parseFloat(document.getElementById('assayV').value);
    const B = parseFloat(document.getElementById('assayB').value);
    const N = parseFloat(document.getElementById('assayN').value);
    const F = 73.1; // F is a fixed value
    const W = parseFloat(document.getElementById('assayW').value);

    const resultElement = document.getElementById('assayResult');
    const resultElementPPM = document.getElementById('assayResultPPM');

    if (isNaN(V) || isNaN(B) || isNaN(N)) {
        resultElement.textContent = "Error: Please fill all fields with valid numbers.";
        resultElement.className = 'font-bold text-red-500';
        resultElementPPM.textContent = "--";
        resultElementPPM.className = 'font-bold text-red-500';
        setCalculationResult('assay', 'Error', '', 'error');
        return;
    }

    const resultPercentage = ((V - B) * N * F * 100) / W;
    const resultPPM = resultPercentage * 10000; // 1% = 10,000 ppm

    resultElement.textContent = resultPercentage.toFixed(2);
    resultElementPPM.textContent = resultPPM.toFixed(0);

    // Check if the result is within the acceptance criteria (99.0% to 101.0%)
    const isPassing = resultPercentage >= 99.0 && resultPercentage <= 101.0;
    const colorClass = isPassing ? 'text-green-500' : 'text-red-500';

    // Apply color and update the result
    resultElement.className = `font-bold ${colorClass}`;
    resultElementPPM.className = `font-bold ${colorClass}`;

    setCalculationResult('assay', resultPercentage.toFixed(2), '%', 'calculated', '99.0%-101.0%');
};

// Calculation for Loss on Drying (LOD)
window.calculateLOD = function() {
    const initialWeight = parseFloat(document.getElementById('lodInitialWeight').value);
    const finalWeight = parseFloat(document.getElementById('lodFinalWeight').value);
    const resultElement = document.getElementById('lodResult');
    const resultElementPPM = document.getElementById('lodResultPPM');

    if (isNaN(initialWeight) || isNaN(finalWeight)) {
        resultElement.textContent = "Error: Please fill all fields with valid numbers.";
        resultElementPPM.textContent = "--";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        resultElementPPM.classList.remove('text-blue-700');
        resultElementPPM.classList.add('text-red-500');
        setCalculationResult('lod', 'Error', '', 'error');
        return;
    }
    if (initialWeight === 0) {
        resultElement.textContent = "Error: Initial weight (W_initial) cannot be zero.";
        resultElementPPM.textContent = "--";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        resultElementPPM.classList.remove('text-blue-700');
        resultElementPPM.classList.add('text-red-500');
        setCalculationResult('lod', 'Error', '', 'error');
        return;
    }

    const resultPercentage = ((initialWeight - finalWeight) / initialWeight) * 100;
    const resultPPM = resultPercentage * 10000; // Convert percentage to ppm (1% = 10,000 ppm)

    resultElement.textContent = resultPercentage.toFixed(2) + '%';
    resultElementPPM.textContent = resultPPM.toFixed(0) + ' ppm';

    resultElement.classList.remove('text-red-500');
    resultElement.classList.add('text-blue-700');
    resultElementPPM.classList.remove('text-red-500');
    resultElementPPM.classList.add('text-blue-700');

    setCalculationResult('lod', resultPercentage.toFixed(2), '%', 'calculated', 'NMT 0.2%');
};

        // Function to export COA as a PDF
        window.exportCOAPDF = function() {
            const coaContentElement = document.getElementById('coa-content-to-pdf');
            const exportButton = coaContentElement.querySelector('button'); // Select the button within the COA div

            // Hide the button before capturing
            if (exportButton) {
                exportButton.style.display = 'none';
                console.log("Export button hidden for PDF capture.");
            }

            document.fonts.ready().then(() => {
                console.log("Fonts are ready. Starting html2canvas capture.");
                html2canvas(coaContentElement, { // Capture the specific COA content div
                    scale: 3, // Increased scale for higher resolution
                    logging: true, // Enable logging for html2canvas
                    useCORS: true, // Important if you have images/fonts from different origins
                }).then(function(canvas) {
                    console.log("html2canvas capture complete.");
                    // Check if the canvas actually has content
                    if (canvas.width === 0 || canvas.height === 0) {
                        console.error("Captured canvas is empty or has zero dimensions.");
                        alert("Error: Captured content is empty. Please ensure the COA tab is visible and fully loaded.");
                        return; // Stop execution if canvas is empty
                    }

                    const imgData = canvas.toDataURL('image/png');
                    console.log("Canvas converted to image data. Length:", imgData.length);

                    // Check if imgData is valid
                    if (!imgData || imgData.length < 100) { // Arbitrary small length check for validity
                        console.error("Generated image data is invalid or too small.");
                        alert("Error: Failed to convert content to image. The generated PDF might be empty.");
                        return;
                    }

                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');

                    const imgWidth = 210;
                    const pageHeight = 297;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;

                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    pdf.save(`COA_Adipic_Acid_${new Date().toISOString().slice(0, 10)}.pdf`);
                    console.log("PDF save initiated.");

                }).catch(error => {
                    console.error("Error during html2canvas capture or PDF generation:", error);
                    alert("Error capturing content or generating PDF: " + error.message + ". Check console for details.");
                }).finally(() => {
                    // Show the button again after capture (whether successful or not)
                    if (exportButton) {
                        exportButton.style.display = ''; // Reset to default display
                        console.log("Export button shown again.");
                    }
                });
            }).catch(error => {
                console.error("Font loading error (initial promise):", error);
                alert("Font loading error. PDF may not display correctly.");
                if (exportButton) {
                    exportButton.style.display = '';
                }
            });
        };

        // Function to generate MOA document
        window.generateMOADocument = function() {
            let moaHtmlContent = `
                <html lang="fa" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>روش تجزیه و تحلیل (MOA) - آدیپیک اسید</title>
                    <style>
                        body { font-family: 'Vazirmatn', sans-serif; line-height: 1.6; direction: rtl; text-align: right; }
                        h1, h2, h3, h4 { color: #333; margin-top: 1.5em; margin-bottom: 0.5em; }
                        h1 { font-size: 2em; text-align: center; }
                        h2 { font-size: 1.5em; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
                        h3 { font-size: 1.2em; }
                        ul { list-style-type: disc; margin-right: 20px; }
                        ol { list-style-type: decimal; margin-right: 20px; }
                        .ltr-section { direction: ltr; text-align: left; }
                        .ltr-text { direction: ltr; display: inline-block; unicode-bidi: isolate; }
                        table { width: 100%; border-collapse: collapse; margin-top: 1em; direction: ltr; text-align: left;}
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; direction: ltr;}
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>روش تجزیه و تحلیل (MOA) - آدیپیک اسید</h1>
            `;

            const tabsToProcess = [
                { id: 'definition', title: 'تعریف' },
                { id: 'identification', title: 'شناسایی' },
                { id: 'assay', title: 'سنجش' },
                { id: 'impurities', title: 'ناخالصی‌ها' },
                { id: 'specific-tests', title: 'آزمایشات خاص' },
                { id: 'additional-requirements', title: 'الزامات اضافی' }
            ];

            tabsToProcess.forEach(tabInfo => {
                const tabElement = document.getElementById(tabInfo.id);
                if (tabElement) {
                    console.log(`Processing tab: ${tabInfo.id}`);
                    moaHtmlContent += `<h2 style="direction: rtl; text-align: right;">${tabInfo.title}</h2>`;

                    // Create a temporary div to hold processed content for this tab
                    const tempDiv = document.createElement('div');
                    tempDiv.setAttribute('dir', 'rtl'); // Ensure overall direction for this section

                    // Iterate over direct children of the tab content (usually cards)
                    Array.from(tabElement.children).forEach(childNode => {
                        if (childNode.classList.contains('card')) {
                            const clonedCard = childNode.cloneNode(true);

                            // Process specific elements within the card
                            clonedCard.querySelectorAll('h3, h4, p, ul, ol, table').forEach(contentNode => {
                                let contentHtml = '';
                                if (contentNode.tagName === 'TABLE') {
                                     // Handle tables separately to ensure LTR for numbers/values
                                    let tableHtml = `<table class="moa-table-ltr"><thead><tr>`;
                                    Array.from(contentNode.querySelectorAll('thead th')).forEach(th => {
                                        tableHtml += `<th style="direction: ltr; text-align: left;">${th.textContent}</th>`;
                                    });
                                    tableHtml += `</tr></thead><tbody>`;
                                    Array.from(contentNode.querySelectorAll('tbody tr')).forEach(tr => {
                                        tableHtml += `<tr>`;
                                        Array.from(tr.querySelectorAll('td')).forEach(td => {
                                            tableHtml += `<td style="direction: ltr; text-align: left;">${td.innerHTML}</td>`; // Use innerHTML to preserve MathJax if any
                                        });
                                        tableHtml += `</tr>`;
                                    });
                                    tableHtml += `</tbody></table>`;
                                    contentHtml = tableHtml;

                                } else if (contentNode.tagName === 'UL' || contentNode.tagName === 'OL') {
                                    // Handle lists
                                    let listHtml = `<${contentNode.tagName.toLowerCase()}>`;
                                    Array.from(contentNode.children).forEach(li => {
                                        listHtml += `<li style="direction: rtl; text-align: right;">${li.innerHTML}</li>`;
                                    });
                                    listHtml += `</${contentNode.tagName.toLowerCase()}>`;
                                    contentHtml = listHtml;

                                } else {
                                    // For other block elements, extract text content
                                    contentHtml = contentNode.outerHTML; // Get outerHTML to preserve tags like <h3>, <p>
                                }
                                tempDiv.innerHTML += contentHtml;
                            });

                            // Handle input/select elements (results) that are direct children of math-input-group
                            clonedCard.querySelectorAll('.math-input-group').forEach(group => {
                                const labelEl = group.querySelector('label');
                                const inputEl = group.querySelector('input, select');
                                if (inputEl && labelEl) {
                                    let value = inputEl.value;
                                    if (inputEl.tagName === 'SELECT' && inputEl.selectedOptions.length > 0) {
                                        value = inputEl.selectedOptions[0].text;
                                    }

                                    // Only include if value is not empty or default "---"
                                    if (value && value !== '---') {
                                        const p = document.createElement('p');
                                        p.innerHTML = `<span style="direction: rtl; text-align: right; display: inline-block;">${labelEl.textContent}</span>: <span style="direction: ltr; display: inline-block; unicode-bidi: isolate;">${value}</span>`;
                                        tempDiv.appendChild(p);
                                    }
                                }
                            });
                        }
                    });
                    moaHtmlContent += tempDiv.innerHTML; // Append the processed content for this tab
                } else {
                    console.warn(`Tab element not found: ${tabInfo.id}`);
                }
            });

            moaHtmlContent += `</body></html>`;

            console.log("Generated MOA HTML content:", moaHtmlContent);

            try {
                if (typeof saveAs === 'function') {
                    const filename = `MOA_Adipic_Acid_${new Date().toISOString().slice(0, 10)}.doc`;
                    const blob = new Blob([moaHtmlContent], { type: 'application/msword;charset=utf-8' });
                    saveAs(blob, filename);
                    console.log(`MOA document saved as ${filename}`);
                } else {
                    console.error("FileSaver.js 'saveAs' function is not available.");
                    alert("Error: File saving functionality is not available. Please ensure FileSaver.js is loaded correctly.");
                }
            } catch (e) {
                console.error("Error saving MOA document:", e);
                alert("Error saving MOA document: " + e.message + ". Please check browser console for more details.");
            }
        };


        document.addEventListener('DOMContentLoaded', function () {
            const mainTabButtons = document.querySelectorAll('nav .tab-button');
            const mainTabContents = document.querySelectorAll('main > .tab-content');

            mainTabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    mainTabButtons.forEach(btn => {
                        btn.classList.remove('tab-active');
                        btn.classList.add('tab-inactive');
                    });
                    this.classList.add('tab-active');
                    this.classList.remove('tab-inactive');

                    mainTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(this.dataset.tab).classList.remove('hidden');

                    if (typeof MathJax !== 'undefined') {
                        MathJax.typeset([document.getElementById(this.dataset.tab)]);
                    }

                    if (this.dataset.tab === 'coa') {
                        updateCOATab();
                    }
                });
            });

            if (typeof MathJax !== 'undefined') {
                MathJax.typeset([document.getElementById('definition')]);
            }

            updateCOATab();
        });
    </script>
</body>
</html>
