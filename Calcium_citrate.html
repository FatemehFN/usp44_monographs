<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مونوگراف سیترات کلسیم (USP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
            word-spacing: normal;
            letter-spacing: normal;
        }
        .tab-active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
        .tab-inactive { border-color: transparent; color: #6b7280; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-right: auto; margin-left: auto; height: 350px; max-height: 40vh; }
        table {
            direction: rtl;
            text-align: right;
        }
        th {
            text-align: right;
            vertical-align: top;
        }
        td {
            text-align: right;
            vertical-align: middle;
        }

        /* Ensure vertical alignment for all headers in COA table */
        #coa-content-to-pdf table thead th {
            vertical-align: top !important;
        }

        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            line-height: inherit;
            word-spacing: inherit;
            letter-spacing: inherit;
            white-space: normal;
        }
        .ltr-text {
            direction: ltr;
            display: inline-block;
            unicode-bidi: isolate;
        }
        .math-input {
            appearance: none;
            -moz-appearance: textfield;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            width: 100px;
            text-align: left;
            direction: ltr;
        }
        .math-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* Styles for the COA tab content container */
        #coa {
            direction: ltr !important; /* Force LTR for the entire COA tab content */
            text-align: left !important; /* Force left alignment for COA tab content */
        }

        #coa-content-to-pdf {
            direction: ltr;
            text-align: left;
            padding: 1.5rem;
        }
        #coa-content-to-pdf p,
        #coa-content-to-pdf h1,
        #coa-content-to-pdf h2,
        #coa-content-to-pdf h3,
        #coa-content-to-pdf th,
        #coa-content-to-pdf td,
        #coa-content-to-pdf label {
            font-family: 'Vazirmatn', sans-serif;
            line-height: 1.6;
            word-spacing: normal;
            letter-spacing: normal;
            white-space: normal;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }
        #coa-content-to-pdf input[type="text"],
        #coa-content-to-pdf input[type="date"] {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            min-height: 2.8rem;
            box-sizing: border-box;
        }
        .grid.grid-cols-1.md\:grid-cols-2.gap-4.mb-6.text-gray-700.text-sm .flex.items-center.gap-2 {
            align-items: flex-start;
        }
        .grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm .flex.flex-col.items-center {
            min-height: 5rem;
            justify-content: flex-start;
        }
        .grid.grid-cols-1.md\:grid-cols-3.gap-4.mb-6.text-gray-700.text-sm input[type="text"] {
            min-height: 2.8rem;
        }
        #coa-results-table-body td, #coa-results-table-body th {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            box-sizing: border-box;
        }
        #coa-content-to-pdf table th {
            border: none;
            padding-top: 1rem;
            padding-bottom: 1rem;
            font-size: 0.95rem;
            font-weight: 700;
            background-color: #e5e7eb;
        }
        #coa-content-to-pdf table td {
            border: none;
        }
        #coa-content-to-pdf table {
            border-collapse: collapse;
            /* Explicitly force LTR for the entire table */
            direction: ltr !important;
            text-align: left !important;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

<div class="container mx-auto p-4 md:p-8">

<header class="text-center mb-8">
<h1 class="text-3xl md:text-4xl font-bold text-gray-900">مونوگراف سیترات کلسیم (USP)</h1>
<p class="mt-2 text-lg text-gray-600">بررسی مشخصات دارویی طبق مونوگراف USP</p>
</header>

<nav class="mb-8 bg-white p-2 rounded-xl shadow-sm">
<div class="flex justify-center border-b border-gray-200 flex-wrap">
<button data-tab="definition" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-active">تعریف</button>
<button data-tab="identification" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">شناسایی</button>
<button data-tab="assay" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">سنجش</button>
<button data-tab="impurities" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">ناخالصی‌ها</button>
<button data-tab="specific-tests" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">آزمایشات خاص</button>
<button data-tab="packaging-storage" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">بسته‌بندی و نگهداری</button>
<button data-tab="moa" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">MOA</button>
<button data-tab="coa" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 tab-inactive">COA</button>
</div>
</nav>

<main>
<div id="definition" class="tab-content space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">تعریف سیترات کلسیم</h2>
<p class="text-gray-600 mb-6">این بخش شامل تعریف سیترات کلسیم و مقادیر مجاز آن است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">تعریف</h3>
<p class="text-gray-700 mb-4">سیترات کلسیم حاوی چهار مولکول آب هیدراسیون است. هنگامی که در دمای <span class="ltr-text">150°C</span> تا وزن ثابت خشک شود، حاوی حداقل <span class="ltr-text">97.5%</span> و حداکثر <span class="ltr-text">100.5%</span> از <span class="ltr-text">$Ca_{3}(C_{6}\overline{H}_{5}O_{7})_{2}$</span> است.</p>
<p class="text-gray-700 mt-4">فرمول شیمیایی: <span class="ltr-text">$C_{12}H_{10}Ca_{3}O_{14} \cdot 4H_{2}O$</span></p>
<p class="text-gray-700">وزن مولکولی: <span class="ltr-text">570.49</span></p>
</div>
</div>

<div id="identification" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">شناسایی</h2>
<p class="text-gray-600 mb-6">این بخش شامل معیارهای شناسایی سیترات کلسیم است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">آزمایشات شناسایی</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li><span class="font-bold">A.</span>
<ul class="list-circle list-inside ml-5">
<li>تجزیه و تحلیل: <span class="ltr-text">0.5 g</span> را در مخلوطی از <span class="ltr-text">10 mL</span> آب و <span class="ltr-text">2.5 mL</span> اسید نیتریک <span class="ltr-text">2 N</span> حل کنید. <span class="ltr-text">1 mL</span> از <span class="ltr-text">TS</span> سولفات جیوه را اضافه کنید، تا نقطه جوش حرارت دهید و <span class="ltr-text">1 mL</span> از <span class="ltr-text">TS</span> پرمنگنات پتاسیم را اضافه کنید.</li>
<li>معیار پذیرش: یک رسوب سفید تشکیل می‌شود.</li>
</ul>
</li>
<li><span class="font-bold">B.</span>
<ul class="list-circle list-inside ml-5">
<li>نمونه: <span class="ltr-text">0.5 g</span> سیترات کلسیم</li>
<li>تجزیه و تحلیل: نمونه را در کمترین دمای ممکن به طور کامل بسوزانید، خنک کنید و با اسید استیک رقیق شده (<span class="ltr-text">1:10</span>) حل کنید. فیلتر کنید و <span class="ltr-text">10 mL</span> از <span class="ltr-text">TS</span> اگزالات آمونیوم را به فیلتر اضافه کنید.</li>
<li>معیار پذیرش: یک رسوب سفید حجیم که در اسید کلریدریک محلول است، تشکیل می‌شود.</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="assay" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">سنجش</h2>
<p class="text-gray-600 mb-6">این بخش جزئیات روش سنجش برای تعیین مقدار <span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span> در سیترات کلسیم را توضیح می‌دهد. می‌توانید مقادیر را برای محاسبه درصد وارد کنید.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">روش کار:</h3>
<p class="text-gray-700 mb-4">محلول نمونه: <span class="ltr-text">350 mg</span> سیترات کلسیم را که قبلاً در دمای <span class="ltr-text">150°C</span> تا وزن ثابت خشک شده است، در <span class="ltr-text">12 mL</span> اسید کلریدریک <span class="ltr-text">0.5 M</span> حل کنید و با آب تا حدود <span class="ltr-text">100 mL</span> رقیق کنید.</p>
<p class="text-gray-700 mb-4">تجزیه و تحلیل: در حالی که محلول نمونه را هم می‌زنید، <span class="ltr-text">30 mL</span> از <span class="ltr-text">0.05 M</span> تیترانت ادتات دی‌سدیم <span class="ltr-text">VS</span> را از یک buret <span class="ltr-text">50 mL</span> اضافه کنید. <span class="ltr-text">15 mL</span> از هیدروکسید سدیم <span class="ltr-text">1 N</span> و <span class="ltr-text">300 mg</span> هیدروکسی نفتول بلو را اضافه کنید و تیترسنجی را تا نقطه پایانی آبی ادامه دهید. هر <span class="ltr-text">mL</span> از <span class="ltr-text">0.05 M</span> ادتات دی‌سدیم معادل <span class="ltr-text">8.307 mg</span> سیترات کلسیم (<span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span>) است.</p>

<h4 class="font-bold text-gray-800 mt-6 mb-2">محاسبه درصد <span class="ltr-text">$Ca_{3}(C_{6}H_{5}O_{7})_{2}$</span>:</h4>
<p class="font-mono text-center text-lg mb-4">$$Result = \frac{V \times F}{W_{sample}} \times 100$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$V$ = حجم <span class="ltr-text">0.05 M</span> تیترانت ادتات دی‌سدیم مصرفی (<span class="ltr-text">mL</span>)</li>
<li>$F$ = فاکتور معادل، <span class="ltr-text">8.307 mg $Ca_{3}(C_{6}H_{5}O_{7})_{2}$/mL</span></li>
<li>$W_{sample}$ = وزن نمونه سیترات کلسیم گرفته شده (<span class="ltr-text">mg</span>)</li>
</ul>

<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="assayV">\(V\):</label>
<input class="math-input" id="assayV" type="number" value="">
</div>
<div class="math-input-group">
<label for="assayF">\(F\):</label>
<input class="math-input" id="assayF" type="number" value="8.307" readonly>
</div>
<div class="math-input-group">
<label for="assayWsample">\(W_{sample}\):</label>
<input class="math-input" id="assayWsample" type="number" value="">
</div>
<button onclick="calculateAssay()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه سنجش</button>
<div class="math-input-group">
    <label for="assayAdditionalSpec">مشخصات اضافی:</label>
    <input class="math-input" id="assayAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('assay', this.value)">
</div>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه سنجش: <span id="assayResult" class="font-bold text-blue-700">--</span>%</p>
<p class="text-gray-700">نتیجه سنجش به ppm: <span id="assayResultPPM" class="font-bold text-blue-700">--</span> ppm</p>
</div>
<p class="text-gray-700 mt-4">معیار پذیرش: <span class="ltr-text">97.5%-100.5%</span> بر اساس ماده خشک.</p>
</div>
</div>

<div id="impurities" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">ناخالصی‌ها</h2>
<p class="text-gray-600 mb-6">این بخش شامل آزمایشات مربوط به ناخالصی‌ها در سیترات کلسیم است.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div class="card">
<h3 class="text-xl font-bold mb-4">آرسنیک، روش I (<a href="General chapters/〈211〉 ARSENIC.pdf" class="text-blue-600 hover:underline" target="_blank">211</a>)</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>تهیه آزمایش: <span class="ltr-text">1 g</span> سیترات کلسیم را در <span class="ltr-text">5 mL</span> اسید کلریدریک <span class="ltr-text">3 N</span> حل کنید و با آب تا <span class="ltr-text">35 mL</span> رقیق کنید.</li>
<li>معیار پذیرش: <span class="ltr-text">NMT 3 ppm</span></li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="arsenicInput">نتیجه آرسنیک:</label>
        <select class="math-input" id="arsenicInput" onchange="updateCOAImpurityResult('arsenic', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
    <div class="math-input-group">
        <label for="arsenicAdditionalSpec">مشخصات اضافی:</label>
        <input class="math-input" id="arsenicAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('arsenic', this.value)">
    </div>
</div>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">سرب (<a href="General chapters/〈251〉 LEAD.pdf" class="text-blue-600 hover:underline" target="_blank">251</a>)</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>تهیه آزمایش: <span class="ltr-text">0.5 g</span> سیترات کلسیم را در <span class="ltr-text">20 mL</span> اسید کلریدریک <span class="ltr-text">3 N</span> حل کنید. این محلول را روی حمام بخار تا <span class="ltr-text">10 mL</span> تبخیر کنید، با آب تا <span class="ltr-text">20 mL</span> رقیق کنید و خنک کنید. برای آزمایش از <span class="ltr-text">5 mL</span> محلول استاندارد سرب رقیق شده (<span class="ltr-text">5 µg</span> سرب) استفاده کنید.</li>
<li>معیار پذیرش: <span class="ltr-text">NMT 10 ppm</span></li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="leadInput">نتیجه سرب:</label>
        <select class="math-input" id="leadInput" onchange="updateCOAImpurityResult('lead', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
    <div class="math-input-group">
        <label for="leadAdditionalSpec">مشخصات اضافی:</label>
        <input class="math-input" id="leadAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('lead', this.value)">
    </div>
</div>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">حد فلوراید</h3>
<p class="text-gray-700 mb-4">[توجه—تمام محلول‌ها را در ظروف پلاستیکی تهیه و نگهداری کنید.]</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول ذخیره استاندارد:</span> <span class="ltr-text">1000 µg/mL</span> یون فلوراید از <span class="ltr-text">USP Sodium Fluoride RS</span> در آب.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول استاندارد:</span> <span class="ltr-text">5 µg/ml</span> یون فلوراید از محلول ذخیره استاندارد. [توجه—در روز استفاده تهیه شود.]</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن A:</span> <span class="ltr-text">1.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید. <span class="ltr-text">50 mL</span> آب، <span class="ltr-text">5 mL</span> اسید کلریدریک <span class="ltr-text">1 N</span>، <span class="ltr-text">10 mL</span> سیترات سدیم <span class="ltr-text">1.0 M</span> و <span class="ltr-text">10 mL</span> ادتات دی‌سدیم <span class="ltr-text">0.2 M</span> را اضافه کنید. در صورت لزوم، با هیدروکسید سدیم <span class="ltr-text">1 N</span> یا اسید کلریدریک <span class="ltr-text">1 N</span> تا <span class="ltr-text">pH 5.5</span> تنظیم کنید. به یک فلاسک حجمی <span class="ltr-text">100-mL</span> منتقل کرده و با آب به حجم برسانید. این محلول حاوی <span class="ltr-text">0.05 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن B:</span> <span class="ltr-text">5.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و طبق دستورالعمل محلول خطی بودن A از "اضافه کردن <span class="ltr-text">50 mL</span> آب" ادامه دهید. این محلول حاوی <span class="ltr-text">0.25 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول خطی بودن C:</span> <span class="ltr-text">10.0 mL</span> از محلول استاندارد را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و طبق دستورالعمل محلول خطی بودن A از "اضافه کردن <span class="ltr-text">50 mL</span> آب" ادامه دهید. این محلول حاوی <span class="ltr-text">0.50 µg/mL</span> فلوراید است.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">محلول نمونه:</span> <span class="ltr-text">1.0 g</span> سیترات کلسیم را به یک بشر <span class="ltr-text">100-mL</span> منتقل کنید. <span class="ltr-text">10 mL</span> آب اضافه کنید و در حین هم زدن، <span class="ltr-text">10 mL</span> اسید کلریدریک <span class="ltr-text">1 N</span> را اضافه کنید. پس از حل شدن، به سرعت به مدت <span class="ltr-text">1 min</span> بجوشانید، محلول را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کرده و در آب یخ خنک کنید. <span class="ltr-text">15 mL</span> سیترات سدیم <span class="ltr-text">1.0 M</span> و <span class="ltr-text">10 mL</span> ادتات دی‌سدیم <span class="ltr-text">0.2 M</span> را اضافه کنید و با هیدروکسید سدیم <span class="ltr-text">1 N</span> یا اسید کلریدریک <span class="ltr-text">1 N</span> تا <span class="ltr-text">pH 5.5</span> تنظیم کنید. این محلول را به یک فلاسک حجمی <span class="ltr-text">100-mL</span> منتقل کرده و با آب به حجم برسانید.</p>
<p class="text-gray-700 mb-2"><span class="font-bold">سیستم الکترود:</span> از یک الکترود یون-انتخابی فلوراید و یک الکترود مرجع نقره-نقره کلرید متصل به یک pH متر با قابلیت اندازه‌گیری پتانسیل‌ها با حداقل تکرارپذیری <span class="ltr-text">±0.2 mV</span> استفاده کنید (به pH (<a href="General chapters/〈791〉 pH.pdf" class="text-blue-600 hover:underline" target="_blank">791</a>) مراجعه کنید).</p>
<p class="text-gray-700 mb-4"><span class="font-bold">تجزیه و تحلیل:</span></p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
    <li>نمونه‌ها: محلول خطی بودن A، محلول خطی بودن B، محلول خطی بودن C و محلول نمونه</li>
    <li><span class="ltr-text">50 mL</span> از هر یک از محلول‌های خطی بودن A، B و C را به بشرهای پلاستیکی <span class="ltr-text">250-mL</span> جداگانه منتقل کنید و پتانسیل هر محلول را با سیستم الکترود اندازه‌گیری کنید. بین هر بار خواندن، الکترودها را با آب بشویید و هرگونه آب باقیمانده را با خشک کردن الکترودها جذب کنید. لگاریتم غلظت‌های فلوراید (<span class="ltr-text">0.05، 0.25 و 0.50 µg/mL</span>، به ترتیب) را در برابر پتانسیل رسم کنید تا یک خط پاسخ استاندارد به دست آید.</li>
    <li><span class="ltr-text">50 mL</span> از محلول نمونه را به یک بشر پلاستیکی <span class="ltr-text">250-mL</span> منتقل کنید و پتانسیل را با سیستم الکترود اندازه‌گیری کنید. از پتانسیل اندازه‌گیری شده و خط پاسخ استاندارد, غلظت <span class="ltr-text">C</span>، بر حسب <span class="ltr-text">µg/mL</span> یون فلوراید در محلول نمونه را تعیین کنید. درصد فلوراید در نمونه گرفته شده را با ضرب <span class="ltr-text">C</span> در <span class="ltr-text">0.01</span> محاسبه کنید.</li>
</ul>
<p class="font-mono text-center text-lg mb-4">$$Result = C \times 0.01$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$C$ = غلظت یون فلوراید در محلول نمونه (<span class="ltr-text">$\mu g/mL$</span>)</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="fluorideC">\(C\):</label>
<input class="math-input" id="fluorideC" type="number" value="">
</div>
<button onclick="calculateFluorideLimit()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه حد فلوراید</button>
<div class="math-input-group">
    <label for="fluorideAdditionalSpec">مشخصات اضافی:</label>
    <input class="math-input" id="fluorideAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('limitOfFluoride', this.value)">
</div>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه فلوراید: <span id="fluorideResult" class="font-bold text-blue-700">--</span>%</p>
<p class="text-gray-700">نتیجه فلوراید به ppm: <span id="fluorideResultPPM" class="font-bold text-blue-700">--</span> ppm</p>
</div>
<p class="text-gray-700 mt-4">معیار پذیرش: <span class="ltr-text">NMT 0.003%</span></p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">حد مواد نامحلول در اسید</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>محلول نمونه: <span class="ltr-text">5 g</span> سیترات کلسیم را با حرارت دادن با مخلوطی از اسید کلریدریک و آب (<span class="ltr-text">10:50</span>) به مدت <span class="ltr-text">30 min</span> حل کنید.</li>
<li>تجزیه و تحلیل: باقیمانده به دست آمده را فیلتر کنید، بشویید و در دمای <span class="ltr-text">105°C</span> به مدت <span class="ltr-text">2 h</span> خشک کنید.</li>
<li>معیار پذیرش: وزن باقیمانده <span class="ltr-text">NMT 10 mg (0.2%)</span> است.</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm mt-4">
    <div class="math-input-group">
        <label for="acidInsolubleInput">نتیجه مواد نامحلول در اسید:</label>
        <select class="math-input" id="acidInsolubleInput" onchange="updateCOAImpurityResult('acidInsoluble', this.value)">
            <option value="">---</option>
            <option value="Pass">Pass</option>
            <option value="Fail">Fail</option>
        </select>
    </div>
    <div class="math-input-group">
        <label for="acidInsolubleAdditionalSpec">مشخصات اضافی:</label>
        <input class="math-input" id="acidInsolubleAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('acidInsoluble', this.value)">
    </div>
</div>
</div>
</div>
</div>

<div id="specific-tests" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">آزمایشات خاص</h2>
<p class="text-gray-600 mb-6">این بخش شامل آزمایشات خاصی است که برای اطمینان از کیفیت و خلوص سیترات کلسیم انجام می‌شود، از جمله افت وزن در اثر خشک شدن.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div class="card">
<h3 class="text-xl font-bold mb-4">افت وزن در اثر خشک شدن (LOD) (<a href="General chapters/〈731〉 LOSS ON DRYING.pdf" class="text-blue-600 hover:underline" target="_blank">731</a>)</h3>
<p class="text-gray-700 mb-4">نمونه‌ای را در دمای <span class="ltr-text">150°C</span> به مدت <span class="ltr-text">4 h</span> خشک کنید: <span class="ltr-text">10.0%</span> تا <span class="ltr-text">13.3%</span> از وزن خود را از دست می‌دهد.</p>
<h4 class="font-bold text-gray-800 mt-6 mb-2">محاسبه افت وزن در اثر خشک شدن (LOD):</h4>
<p class="font-mono text-center text-lg mb-4">$$LOD = \frac{(W_{initial} - W_{final})}{W_{initial}} \times 100$$</p>
<ul class="list-disc list-inside text-gray-700 space-y-1 mb-6">
<li>$W_{initial}$ = وزن اولیه نمونه (<span class="ltr-text">g</span>)</li>
<li>$W_{final}$ = وزن نهایی نمونه پس از خشک شدن (<span class="ltr-text">g</span>)</li>
</ul>
<div class="flex flex-col gap-2 justify-center items-center text-gray-700 text-sm">
<div class="math-input-group">
<label for="lodInitialWeight">\(W_{initial}\):</label>
<input class="math-input" id="lodInitialWeight" type="number" value="">
</div>
<div class="math-input-group">
<label for="lodFinalWeight">\(W_{final}\):</label>
<input class="math-input" id="lodFinalWeight" type="number" value="">
</div>
<button onclick="calculateLOD()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">محاسبه LOD</button>
<div class="math-input-group">
    <label for="lodAdditionalSpec">مشخصات اضافی:</label>
    <input class="math-input" id="lodAdditionalSpec" type="text" value="" onchange="updateCOAAdditionalSpec('lod', this.value)">
</div>
</div>
<div class="text-center mt-4">
<p class="text-gray-700">نتیجه LOD: <span id="lodResult" class="font-bold text-blue-700">--</span>%</p>
<p class="text-gray-700">نتیجه LOD به ppm: <span id="lodResultPPM" class="font-bold text-blue-700">--</span> ppm</p>
</div>
</div>
</div>
</div>

<div id="packaging-storage" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800">بسته‌بندی و نگهداری</h2>
<p class="text-gray-600 mb-6">این بخش شامل اطلاعات مهم در مورد نحوه بسته‌بندی و نگهداری سیترات کلسیم است.</p>
</div>
<div class="card">
<h3 class="text-xl font-bold mb-4">بسته‌بندی و نگهداری</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li>در ظروف محکم نگهداری شود.</li>
</ul>
<h3 class="text-xl font-bold mb-4 mt-6">استانداردهای مرجع USP</h3>
<ul class="space-y-3 list-disc list-inside text-gray-700">
<li><span class="ltr-text">USP Sodium Fluoride RS</span></li>
</ul>
</div>
</div>

<div id="moa" class="tab-content hidden space-y-8">
    <div class="card">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">روش تجزیه و تحلیل (MOA)</h2>
        <p class="text-gray-600 mb-6">این بخش اطلاعات روش تجزیه و تحلیل را از تمام بخش‌های مونوگراف گردآوری می‌کند.</p>
        <button onclick="generateMOADocument()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4">تولید سند MOA (Word)</button>
    </div>
</div>

<div id="coa" class="tab-content hidden space-y-8">
<div class="card">
<h2 class="text-2xl font-bold mb-4 text-gray-800" style="text-align: left; direction: ltr;">Certificate of Analysis (COA)</h2>
<p class="text-gray-600 mb-6" style="text-align: left; direction: ltr;">This section summarizes the results of tests and calculations performed according to the monograph.</p>
</div>
<div class="card" id="coa-content-to-pdf" dir="ltr">
<h3 class="text-xl font-bold mb-4">Product Information</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-gray-700 text-sm">
<div class="flex items-center gap-2">
<label for="coaProductName" class="font-bold">Product Name:</label>
<span id="coaProductNameDisplay" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100 text-gray-700">Calcium Citrate</span>
</div>
<div class="flex items-center gap-2">
<label for="coaBatchNumber" class="font-bold">Batch Number:</label>
<input type="text" id="coaBatchNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaMfgDate" class="font-bold">Mfg. Date:</label>
<input type="date" id="coaMfgDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaProductCode" class="font-bold">Product Code:</label>
<input type="text" id="coaProductCode" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaRetestDate" class="font-bold">Retest Date:</label>
<input type="date" id="coaRetestDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div class="flex items-center gap-2">
<label for="coaAnalysisNumber" class="font-bold">Analysis Number:</label>
<input type="text" id="coaAnalysisNumber" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
</div>

<h3 class="text-xl font-bold mb-4">Test Results</h3>
<div class="overflow-x-auto mb-6">
<table class="min-w-full bg-white border border-gray-200">
<thead class="bg-gray-100">
<tr>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Tests</th>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Pharmacopoeia (USP 44)</th>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Additional Specifications</th>
<th class="py-3 px-4 font-bold text-sm text-gray-600 uppercase tracking-wider text-left">Results</th>
</tr>
</thead>
<tbody id="coa-results-table-body">
</tbody>
</table>
</div>

<h3 class="text-xl font-bold mb-4">Signatures</h3>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-gray-700 text-sm">
<div class="flex flex-col items-center">
<label for="coaAnalyst" class="font-bold mb-1">Analyst:</label>
<input type="text" id="coaAnalyst" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
<div class="flex flex-col items-center">
<label for="coaSupervisor" class="font-bold mb-1">QC Lab Supervisor:</label>
<input type="text" id="coaSupervisor" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
<div class="flex flex-col items-center">
<label for="coaQCManager" class="font-bold mb-1">QC Manager:</label>
<input type="text" id="coaQCManager" class="w-full p-2 border border-gray-300 rounded-md text-center" value="">
</div>
</div>

<div class="flex justify-center">
<button onclick="exportCOAPDF()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mt-4">Save COA as PDF</button>
</div>
</div>
</div>
</main>
</div>

<script>
// Object to store calculation results for COA
let calculationResults = {
    assay: { label: 'Assay', value: '--', unit: '%', status: 'initial', spec: '97.5%-100.5%', additionalSpec: '' },
    arsenic: { label: 'Arsenic', value: '', unit: '', status: 'initial', spec: 'NMT 3 ppm', additionalSpec: '' },
    lead: { label: 'Lead', value: '', unit: '', status: 'initial', spec: 'NMT 10 ppm', additionalSpec: '' },
    limitOfFluoride: { label: 'Limit of Fluoride', value: '--', unit: '%', status: 'initial', spec: 'NMT 0.003%', additionalSpec: '' },
    acidInsoluble: { label: 'Acid-Insoluble Substances', value: '', unit: '', status: 'initial', spec: 'NMT 10 mg (0.2%)', additionalSpec: '' },
    lod: { label: 'Loss on Drying (LOD)', value: '--', unit: '%', status: 'initial', spec: '10.0%-13.3%', additionalSpec: '' },
};

// Function to update the COA tab content dynamically
function updateCOATab() {
    const coaResultsTableBody = document.getElementById('coa-results-table-body');
    if (!coaResultsTableBody) return; // Exit if COA table body not found

    coaResultsTableBody.innerHTML = ''; // Clear existing rows

    for (const key in calculationResults) {
        if (calculationResults.hasOwnProperty(key)) {
            const resultData = calculationResults[key];
            const tableRow = document.createElement('tr');
            let valueContent;
            let valueClass = ''; // Initialize valueClass

            // Determine content and class based on status
            if (resultData.status === 'initial' || resultData.status === 'user-entered') {
                valueContent = resultData.value;
                valueClass = 'text-gray-700';
            } else if (resultData.status === 'error') {
                valueContent = resultData.value + resultData.unit;
                valueClass = 'text-red-500';
            } else { // 'calculated'
                valueContent = resultData.value + resultData.unit;
                valueClass = 'text-blue-700';
            }
            
            // Special handling for LOD and Assay to check for color-coded results
            if (key === 'lod' || key === 'assay') {
                const resultPercentage = parseFloat(resultData.value);
                let pass = false;
                if (key === 'lod') {
                    pass = resultPercentage >= 10.0 && resultPercentage <= 13.3;
                } else if (key === 'assay') {
                    pass = resultPercentage >= 97.5 && resultPercentage <= 100.5;
                }

                if (pass) {
                    valueClass = 'text-green-500';
                } else {
                    valueClass = 'text-red-500';
                }
            }


            tableRow.innerHTML = `
                <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.label}</td>
                <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.spec}</td>
                <td class="py-2 px-3" style="direction: ltr; text-align: left;">${resultData.additionalSpec}</td>
                <td class="py-2 px-3 font-bold ${valueClass}">
                    <span style="display: inline-block; width: 100%; text-align: left;">
                        ${valueContent}
                    </span>
                </td>
            `;
            coaResultsTableBody.appendChild(tableRow);
        }
    }
}

// Function to update user-entered impurity results
window.updateCOAImpurityResult = function(key, value) {
    calculationResults[key].value = value;
    calculationResults[key].status = 'user-entered'; // Mark as user-entered
    updateCOATab(); // Update COA tab after any calculation
};

// Function to update additional specifications
window.updateCOAAdditionalSpec = function(key, value) {
    calculationResults[key].additionalSpec = value;
    updateCOATab(); // Update COA tab to reflect the new additional spec
};


// Helper function to update a specific calculation result and then the COA tab
function setCalculationResult(key, value, unit = '', status = 'calculated', spec = null) {
    calculationResults[key].value = value;
    calculationResults[key].unit = unit;
    calculationResults[key].status = status;
    if (spec !== null) {
        calculationResults[key].spec = spec;
    }
    updateCOATab(); // Update COA tab after any calculation
};

// Calculation function for Assay
window.calculateAssay = function() {
    const V = parseFloat(document.getElementById('assayV').value);
    const F = parseFloat(document.getElementById('assayF').value);
    const W_sample = parseFloat(document.getElementById('assayWsample').value);

    const resultElement = document.getElementById('assayResult');
    const resultElementPPM = document.getElementById('assayResultPPM');

    if (isNaN(V) || isNaN(F) || isNaN(W_sample) || W_sample === 0) {
        resultElement.textContent = "Error: Please fill all fields with valid numbers, and W_sample cannot be zero.";
        resultElement.className = 'font-bold text-red-500';
        resultElementPPM.textContent = "--";
        resultElementPPM.className = 'font-bold text-red-500';
        setCalculationResult('assay', 'Error', '', 'error');
        return;
    }

    const resultPercentage = (V * F * 100) / W_sample;
    const resultPPM = resultPercentage * 10000; // 1% = 10,000 ppm

    resultElement.textContent = resultPercentage.toFixed(2);
    resultElementPPM.textContent = resultPPM.toFixed(0);

    // Check if the result is within the acceptance criteria (97.5% to 100.5%)
    const isPassing = resultPercentage >= 97.5 && resultPercentage <= 100.5;
    const colorClass = isPassing ? 'text-green-500' : 'text-red-500';

    // Apply color to the results
    resultElement.className = `font-bold ${colorClass}`;
    resultElementPPM.className = `font-bold ${colorClass}`;

    setCalculationResult('assay', resultPercentage.toFixed(2), '%', 'calculated', '97.5%-100.5%');
};


// Calculation function for Limit of Fluoride
window.calculateFluorideLimit = function() {
    const C = parseFloat(document.getElementById('fluorideC').value);

    const resultElement = document.getElementById('fluorideResult');
    const resultElementPPM = document.getElementById('fluorideResultPPM');

    if (isNaN(C)) {
        resultElement.textContent = "Error: Please fill all fields with valid numbers.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        setCalculationResult('limitOfFluoride', 'Error', '', 'error');
        return;
    }

    const resultPercentage = C * 0.01;
    const resultPPM = resultPercentage * 10000;

    resultElement.textContent = resultPercentage.toFixed(3) + '%';
    resultElementPPM.textContent = resultPPM.toFixed(2) + ' ppm';

    const isPassing = resultPercentage <= 0.003;
    const colorClass = isPassing ? 'text-green-500' : 'text-red-500';

    resultElement.classList.remove('text-blue-700', 'text-red-500', 'text-green-500');
    resultElement.classList.add(colorClass);
    resultElementPPM.classList.remove('text-blue-700', 'text-red-500', 'text-green-500');
    resultElementPPM.classList.add(colorClass);

    setCalculationResult('limitOfFluoride', resultPercentage.toFixed(3), '%', 'calculated', 'NMT 0.003%');
};


// Calculation function for Loss on Drying (LOD)
window.calculateLOD = function() {
    const initialWeight = parseFloat(document.getElementById('lodInitialWeight').value);
    const finalWeight = parseFloat(document.getElementById('lodFinalWeight').value);
    const resultElement = document.getElementById('lodResult');
    const resultElementPPM = document.getElementById('lodResultPPM');

    if (isNaN(initialWeight) || isNaN(finalWeight)) {
        resultElement.textContent = "Error: Please fill all fields with valid numbers.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        resultElementPPM.textContent = "--";
        resultElementPPM.classList.remove('text-blue-700');
        resultElementPPM.classList.add('text-red-500');
        setCalculationResult('lod', 'Error', '', 'error');
        return;
    }
    if (initialWeight === 0) {
        resultElement.textContent = "Error: Initial weight (W_initial) cannot be zero.";
        resultElement.classList.remove('text-blue-700');
        resultElement.classList.add('text-red-500');
        resultElementPPM.textContent = "--";
        resultElementPPM.classList.remove('text-blue-700');
        resultElementPPM.classList.add('text-red-500');
        setCalculationResult('lod', 'Error', '', 'error');
        return;
    }

    const resultPercentage = ((initialWeight - finalWeight) / initialWeight) * 100;
    const resultPPM = resultPercentage * 10000; // Convert percentage to ppm (1% = 10,000 ppm)

    resultElement.textContent = resultPercentage.toFixed(2) + '%';
    resultElementPPM.textContent = resultPPM.toFixed(0) + ' ppm';

    // Check if the result is within the acceptance criteria (10.0% to 13.3%)
    const isPassing = resultPercentage >= 10.0 && resultPercentage <= 13.3;
    const colorClass = isPassing ? 'text-green-500' : 'text-red-500';

    // Apply color to the results
    resultElement.className = `font-bold ${colorClass}`;
    resultElementPPM.className = `font-bold ${colorClass}`;

    setCalculationResult('lod', resultPercentage.toFixed(2), '%', 'calculated', '10.0%-13.3%');
};


// Function to export COA as a PDF
window.exportCOAPDF = function() {
    const coaContentElement = document.getElementById('coa-content-to-pdf');
    const exportButton = coaContentElement.querySelector('button'); // Select the button within the COA div

    // Hide the button before capturing
    if (exportButton) {
        exportButton.style.display = 'none';
        console.log("Export button hidden for PDF capture.");
    }

    document.fonts.ready().then(() => {
        console.log("Fonts are ready. Starting html2canvas capture.");
        html2canvas(coaContentElement, { // Capture the specific COA content div
            scale: 3, // Increased scale for higher resolution
            logging: true, // Enable logging for html2canvas
            useCORS: true, // Important if you have images/fonts from different origins
        }).then(function(canvas) {
            console.log("html2canvas capture complete.");
            // Check if the canvas actually has content
            if (canvas.width === 0 || canvas.height === 0) {
                console.error("Captured canvas is empty or has zero dimensions.");
                alert("Error: Captured content is empty. Please ensure the COA tab is visible and fully loaded.");
                return; // Stop execution if canvas is empty
            }

            const imgData = canvas.toDataURL('image/png');
            console.log("Canvas converted to image data. Length:", imgData.length);

            // Check if imgData is valid
            if (!imgData || imgData.length < 100) { // Arbitrary small length check for validity
                console.error("Generated image data is invalid or too small.");
                alert("Error: Failed to convert content to image. The generated PDF might be empty.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            let heightLeft = imgHeight;

            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            pdf.save(`COA_Calcium_Citrate_${new Date().toISOString().slice(0, 10)}.pdf`);
            console.log("PDF save initiated.");

        }).catch(error => {
            console.error("Error during html2canvas capture or PDF generation:", error);
            alert("Error capturing content or generating PDF: " + error.message + ". Check console for details.");
        }).finally(() => {
            // Show the button again after capture (whether successful or not)
            if (exportButton) {
                exportButton.style.display = ''; // Reset to default display
                console.log("Export button shown again.");
            }
        });
    }).catch(error => {
        console.error("Font loading error (initial promise):", error);
        alert("Font loading error. PDF may not display correctly.");
        if (exportButton) {
            exportButton.style.display = '';
        }
    });
};

// Function to generate MOA document
window.generateMOADocument = function() {
    let moaHtmlContent = `
        <html lang="fa" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>روش تجزیه و تحلیل (MOA) - سیترات کلسیم</title>
            <style>
                body { font-family: 'Vazirmatn', sans-serif; line-height: 1.6; direction: rtl; text-align: right; }
                h1, h2, h3, h4 { color: #333; margin-top: 1.5em; margin-bottom: 0.5em; }
                h1 { font-size: 2em; text-align: center; }
                h2 { font-size: 1.5em; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
                h3 { font-size: 1.2em; }
                ul { list-style-type: disc; margin-right: 20px; }
                ol { list-style-type: decimal; margin-right: 20px; }
                .ltr-section { direction: ltr; text-align: left; }
                .ltr-text { direction: ltr; display: inline-block; unicode-bidi: isolate; }
                table { width: 100%; border-collapse: collapse; margin-top: 1em; direction: ltr; text-align: left;}
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; direction: ltr;}
                th { background-color: #f2f2f2; }
            </style>
        </head>
        <body>
            <h1>روش تجزیه و تحلیل (MOA) - سیترات کلسیم</h1>
    `;

    const tabsToProcess = [
        { id: 'definition', title: 'تعریف' },
        { id: 'identification', title: 'شناسایی' },
        { id: 'assay', title: 'سنجش' },
        { id: 'impurities', title: 'ناخالصی‌ها' },
        { id: 'specific-tests', title: 'آزمایشات خاص' },
        { id: 'packaging-storage', title: 'بسته‌بندی و نگهداری' }
    ];

    tabsToProcess.forEach(tabInfo => {
        const tabElement = document.getElementById(tabInfo.id);
        if (tabElement) {
            console.log(`Processing tab: ${tabInfo.id}`);
            moaHtmlContent += `<h2 style="direction: rtl; text-align: right;">${tabInfo.title}</h2>`;

            const tempDiv = document.createElement('div');
            tempDiv.setAttribute('dir', 'rtl');

            Array.from(tabElement.children).forEach(childNode => {
                if (childNode.classList.contains('card')) {
                    const clonedCard = childNode.cloneNode(true);

                    clonedCard.querySelectorAll('h3, h4, p, ul, ol, table').forEach(contentNode => {
                        let contentHtml = '';
                        if (contentNode.tagName === 'TABLE') {
                            let tableHtml = `<table class="moa-table-ltr"><thead><tr>`;
                            Array.from(contentNode.querySelectorAll('thead th')).forEach(th => {
                                tableHtml += `<th style="direction: ltr; text-align: left;">${th.textContent}</th>`;
                            });
                            tableHtml += `</tr></thead><tbody>`;
                            Array.from(contentNode.querySelectorAll('tbody tr')).forEach(tr => {
                                tableHtml += `<tr>`;
                                Array.from(tr.querySelectorAll('td')).forEach(td => {
                                    tableHtml += `<td style="direction: ltr; text-align: left;">${td.innerHTML}</td>`;
                                });
                                tableHtml += `</tr>`;
                            });
                            tableHtml += `</tbody></table>`;
                            contentHtml = tableHtml;

                        } else if (contentNode.tagName === 'UL' || contentNode.tagName === 'OL') {
                            let listHtml = `<${contentNode.tagName.toLowerCase()}>`;
                            Array.from(contentNode.children).forEach(li => {
                                listHtml += `<li style="direction: rtl; text-align: right;">${li.innerHTML}</li>`;
                            });
                            listHtml += `</${contentNode.tagName.toLowerCase()}>`;
                            contentHtml = listHtml;

                        } else {
                            contentHtml = contentNode.outerHTML;
                        }
                        tempDiv.innerHTML += contentHtml;
                    });

                    clonedCard.querySelectorAll('.math-input-group').forEach(group => {
                        const labelEl = group.querySelector('label');
                        const inputEl = group.querySelector('input, select');
                        if (inputEl && labelEl) {
                            let value = inputEl.value;
                            if (inputEl.tagName === 'SELECT' && inputEl.selectedOptions.length > 0) {
                                value = inputEl.selectedOptions[0].text;
                            }

                            if (value && value !== '---') {
                                const p = document.createElement('p');
                                p.innerHTML = `<span style="direction: rtl; text-align: right; display: inline-block;">${labelEl.textContent}</span>: <span style="direction: ltr; display: inline-block; unicode-bidi: isolate;">${value}</span>`;
                                tempDiv.appendChild(p);
                            }
                        }
                    });
                }
            });
            moaHtmlContent += tempDiv.innerHTML;
        } else {
            console.warn(`Tab element not found: ${tabInfo.id}`);
        }
    });

    moaHtmlContent += `</body></html>`;

    console.log("Generated MOA HTML content:", moaHtmlContent);

    try {
        if (typeof saveAs === 'function') {
            const filename = `MOA_Calcium_Citrate_${new Date().toISOString().slice(0, 10)}.doc`;
            const blob = new Blob([moaHtmlContent], { type: 'application/msword;charset=utf-8' });
            saveAs(blob, filename);
            console.log(`MOA document saved as ${filename}`);
        } else {
            console.error("FileSaver.js 'saveAs' function is not available.");
            alert("Error: File saving functionality is not available. Please ensure FileSaver.js is loaded correctly.");
        }
    } catch (e) {
        console.error("Error saving MOA document:", e);
        alert("Error saving MOA document: " + e.message + ". Please check browser console for more details.");
    }
};


document.addEventListener('DOMContentLoaded', function () {
    const mainTabButtons = document.querySelectorAll('nav .tab-button');
    const mainTabContents = document.querySelectorAll('main > .tab-content');

    mainTabButtons.forEach(button => {
        button.addEventListener('click', function() {
            mainTabButtons.forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            this.classList.add('tab-active');
            this.classList.remove('tab-inactive');

            mainTabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(this.dataset.tab).classList.remove('hidden');

            if (typeof MathJax !== 'undefined') {
                MathJax.typeset([document.getElementById(this.dataset.tab)]);
            }

            if (this.dataset.tab === 'coa') {
                updateCOATab();
            }
        });
    });

    if (typeof MathJax !== 'undefined') {
        MathJax.typeset([document.getElementById('definition')]);
    }

    updateCOATab();
});
</script>
</body>
</html>